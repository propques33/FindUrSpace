<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CubiSpace | Booking</title>
    <link rel="stylesheet" href="../static/css/cubispace.css" />
    <link rel="icon" href="../static/images/Asset 6.png" type="image/x-icon" />
    <!-- Flatpickr CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />

    
    <!-- Include OTPless Headless SDK -->
    <script src="https://otpless.com/v4/headless.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-MX8P4NN6");
    </script>
    <!-- End Google Tag Manager -->

    <!-- Facebook Pixel Code -->
    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "https://connect.facebook.net/en_US/fbevents.js"
      );
      fbq("init", "3647529905577467");
      fbq("track", "PageView");
    </script>
    <noscript>
      <img
        height="1"
        width="1"
        src="https://www.facebook.com/tr?id=3647529905577467&ev=PageView
&noscript=1"
      />
    </noscript>
    <!-- End Facebook Pixel Code -->

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-MX8P4NN6");
    </script>
    <!-- End Google Tag Manager -->

    <!-- Facebook Pixel Code -->
    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "https://connect.facebook.net/en_US/fbevents.js"
      );
      fbq("init", "3647529905577467");
      fbq("track", "PageView");
    </script>
    <noscript>
      <img
        height="1"
        width="1"
        src="https://www.facebook.com/tr?id=3647529905577467&ev=PageView
&noscript=1"
      />
    </noscript>
    <!-- End Facebook Pixel Code -->

    <!-- Facebook Pixel Code -->
    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "https://connect.facebook.net/en_US/fbevents.js"
      );
      fbq("init", "1102322410247129");
      fbq("track", "PageView");
    </script>
    <noscript>
      <img
        height="1"
        width="1"
        src="https://www.facebook.com/tr?id=1102322410247129&ev=PageView
&noscript=1"
      />
    </noscript>
    <!-- End Facebook Pixel Code -->
  </head>
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
  <!-- Mapbox CSS -->
  <link
    href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css"
    rel="stylesheet"
  />

  <body>
    <div id="buyNowModal" class="modal">
      <div class="modal-content" id="buyNowModal1">
        <span class="close1" onclick="closeBuyNowModal()">&times;</span>
        <h3 class="modal-title" style="margin-top: 10px">
          Confirm Your Purchase
        </h3>

        <div class="modal-section">
          <label for="buyNowDate">Select Date</label>
          <input
            type="text"
            id="buyNowDate"
            placeholder="Select a date"
            readonly
          />
        </div>

        <div
          id="timeSelectionContainer"
          class="modal-section"
          style="display: none"
        >
          <label for="timeSlotDropdown">Select Timing</label>
          <select id="timeSlotDropdown">
            <option value="">Select Time Slot</option>
          </select>
        </div>

        <div class="modal-form">
          <label for="fullNameBuy">Full Name</label>
          <input
            type="text"
            id="fullNameBuy"
            value="{{ user_data.get('name', '') if user_data else '' }}"
            placeholder="Your Name"
          />

          <label for="emailBuy">Email</label>
          <input
            type="email"
            id="emailBuy"
            value="{{ user_data.get('email', '') if user_data else '' }}"
            placeholder="Your Email"
          />

          <label for="phoneBuy">Phone</label>
          <input
            type="text"
            id="phoneBuy"
            readonly
            disabled
            value="{{ user_data.get('contact', '') if user_data else '' }}"
            placeholder="Your Phone"
          />

          <label for="companyBuy">Company</label>
          <input
            type="text"
            id="companyBuy"
            value="{{ user_data.get('company', '') if user_data else '' }}"
            placeholder="Your Company"
          />

          <label for="gstinBuy">GSTIN (Optional)</label>
          <input
            type="text"
            id="gstinBuy"
            placeholder="Enter GSTIN (if applicable)"
          />
        </div>

        <div class="modal-info">
  <div class="modal-row">
    <span class="modal-label">Selected Inventory:</span>
    <span class="modal-value"><strong>{{ inventoryType }}</strong></span>
  </div>
  <div class="modal-row">
    <span class="modal-label">Total Quantity:</span>
    <span class="modal-value" id="modalPassQuantity">1</span>
  </div>
  <div class="modal-row">
    <span class="modal-label">Inventory Price:</span>
    <span class="modal-value">‚Çπ<span id="modalBasePrice">0</span></span>
  </div>
  <div class="modal-row">
    <span class="modal-label">+ 18% GST:</span>
    <span class="modal-value">‚Çπ<span id="modalGST">0</span></span>
  </div>
  <div class="modal-row">
    <span class="modal-label">Net Price after GST:</span>
    <span class="modal-value">‚Çπ<span id="modalPriceWithGST">0</span></span>
  </div>
  <div class="modal-row">
    <span class="modal-label">Discount Applied:</span>
    <span class="modal-value">- ‚Çπ<span id="modalDiscount">0</span></span>
  </div>
  <div class="modal-row" style="font-weight: bold;">
    <span class="modal-label">Final Payable Amount:</span>
    <span class="modal-value">‚Çπ<span id="modalTotalPrice">0</span></span>
  </div>
</div>


        <div class="modal-footer">
          <button class="modal-btn-confirm" onclick="submitPurchase()">
            Complete Puchase
          </button>
        </div>
      </div>
    </div>

    <!-- Overlay -->
    <div
      id="modalOverlay"
      class="modal-overlay"
      onclick="closeBuyNowModal()"
    ></div>

    <!-- Thank You Modal -->
    <div id="thankYouModal" class="modal">
      <div class="modal-content thank-you-content">
        <span class="close1" id="cl" onclick="closeThankYouModal()"
          >&times;</span
        >
        <div class="checkmark">
          <i class="fas fa-check-circle"></i>
        </div>
        <h3 id="thankYouTitle">Booking Scheduled Successfully!</h3>
        <p id="thankYouMessage">
          Your booking has been scheduled successfully.
        </p>
      </div>
    </div>

    <!-- Background Overlay -->
    <div id="thankYouOverlay" class="modal-overlay"></div>

    <!-- Modal HTML -->
    <div id="popupModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="modal-title">Book Your Space</h2>
        <form id="popupForm">
          <div class="form-group">
            <label for="contact">Contact Number</label>
            <input
              type="tel"
              id="contact"
              name="contact"
              placeholder="Enter your number"
              required
            />
            <button
              type="button"
              onclick="initiateOtp()"
              id="sendOtpBtn"
              class="submit-btn"
              style="margin-top: 8px"
            >
              Send OTP
            </button>
          </div>

          <div class="form-group" id="otpSection" style="display: none">
            <div id="otpMessage" class="otp-alert otp-info">
              Waiting for OTP input...
            </div>
            <label for="otpInput">Enter OTP</label>
            <input type="text" id="otpInput" placeholder="6-digit OTP" />
            <div style="display: flex; gap: 10px; margin-top: 8px">
              <button
                type="button"
                onclick="resendOtp()"
                id="resendOtpBtn"
                class="submit-btn"
                style="
                  flex: 1;
                  background-color: #ccc;
                  color: #666;
                  cursor: not-allowed;
                "
                disabled
              >
                Resend OTP (60s)
              </button>
              <button
                type="button"
                onclick="verifyOtp()"
                id="verifyOtpBtn"
                class="submit-btn"
                style="flex: 1"
              >
                Verify OTP
              </button>
            </div>
          </div>

          <!-- Inventory selection (initially hidden) -->
          <div class="form-group" id="inventorySection" style="display: none">
            <label for="inventory">Inventory Type</label>
            <select id="inventory" name="inventory" required>
              <option value="">Select</option>
              <option value="daypass">Day Pass</option>
              <option value="meetingroom">Meeting Room</option>
            </select>
          </div>

          <div class="form-group" id="seaterGroup" style="display: none">
            <label for="seater">Seats</label>
            <select id="seater" name="seater">
              <option value="">Select</option>
              <option value="4">4 Seater</option>
              <option value="6">6 Seater</option>
              <option value="25">25 Seater</option>
            </select>
          </div>

          <button
            type="submit"
            class="submit-btn"
            id="submitBtn"
            style="display: none"
          >
            Submit
          </button>
        </form>
      </div>
    </div>

    <section class="navbar-container">
      <nav class="navbar">
        <!-- Logo -->
        <div class="logo">
          <img src="../static/images/Logo.svg" alt="CUBIspace Logo" />
        </div>

        <!-- Navigation Links -->
        <ul class="nav-links">
          <!--           <li><a href="https://www.cubispace.com/">Home</a></li>
          <li><a href="https://www.cubispace.com/coworking-in-jankipuram-lucknow/">About Us</a></li> -->
        </ul>

        <!-- CTA Button -->
        <button class="book-btn book-now" id="bookNowBtn">
          Book an experience
        </button>
      </nav>
    </section>
    <section class="hero">
      <div class="hero-content">
        <h1>
          <span>Cubispace</span> <br />
          Making space for Life in Work
        </h1>
        <p>
          Having a cool work-life is everyone‚Äôs desire whether it be a
          solopreneur or a team-player. Establishing a workspace that suits all,
          we plan on fulfilling everything that a professional needs from a
          workplace.
        </p>
      </div>
    </section>

    <h1 class="st">SEATING OPTION</h1>
    <!-- <h5></h5> -->
    <div class="seating-option">
      <img
        src="{{ selected_inventory.images[0] if selected_inventory and selected_inventory.images else property.property_images[0] }}"
        alt="{{ inventoryType }}"
        alt="selected inventory image"
      />
      <div class="seating-details">
        <div class="seating-info">
          <h2 id="dynamicInventoryType">{{ inventoryType }}</h2>
          <p>
            {% if inventoryType == "Day Pass" %} Flexible workspace for a day
            with shared amenities. {% elif inventoryType == "Meeting Room" %}
            Private rooms for client meetings, brainstorming, or presentations.
            {% else %} Contact for more details on this workspace. {% endif %}
          </p>
        </div>
        <div>
          <span class="price-range"
            >Price range <br />
            {% if inventoryType == "Day Pass" %} ‚Çπ500 /seat/day {% elif
            inventoryType == "Meeting Room" %} ‚Çπ{{ total_price }} {% else %}
            Contact for pricing {% endif %}
          </span>
        </div>
      </div>
    </div>

    <div class="container">
      <!-- Left Section (70%) -->
      <div class="left-section">
        <div class="gallery-container">
          <button id="prevBtn">‚ùÆ</button>
          <img
            class="slide-img"
            id="galleryImage"
            src="{{ property.property_images[0] }}"
            alt="Gallery Image"
          />
          <button id="nextBtn">‚ùØ</button>
        </div>

        {% if inventoryType == "Meeting Room" %}
        <div class="time-section">
          <h3 class="section-title">
            <i class="fas fa-clock"></i> Meeting Room Timing
          </h3>
          <div class="office-timing">
            <div class="timing-card">
              <img
                src="{{ url_for('static', filename='images/calender.png') }}"
                alt="Calendar Icon"
              />
              <div class="timing-details">
                <span>Mon - Fri</span>
                <p>09:00 - 21:00</p>
              </div>
            </div>
            <div class="timing-card">
              <img
                src="{{ url_for('static', filename='images/calender.png') }}"
                alt="Calendar Icon"
              />
              <div class="timing-details">
                <span>Sat</span>
                <p>09:00 - 21:00</p>
              </div>
            </div>
            <div class="timing-card closed">
              <img
                src="{{ url_for('static', filename='images/calender.png') }}"
                alt="Calendar Icon"
              />
              <div class="timing-details">
                <span>Sun</span>
                <p>Closed</p>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        <div class="time-section">
          <h3 class="section-title">
            <i class="fas fa-clock"></i> Office Timing
          </h3>
          <div class="office-timing">
            <div class="timing-card">
              <img
                src="{{ url_for('static', filename='images/calender.png') }}"
                alt="Calendar Icon"
              />
              <div class="timing-details">
                <span>Mon - Fri</span>
                <p>
                  {{ office_timings.opening_time }} - {{
                  office_timings.closing_time }}
                </p>
              </div>
            </div>

            <div class="timing-card">
              <img
                src="{{ url_for('static', filename='images/calender.png') }}"
                alt="Calendar Icon"
              />
              <div class="timing-details">
                <span>Sat</span>
                <p>
                  {{ office_timings.opening_time }} - {{
                  office_timings.closing_time }}
                </p>
              </div>
            </div>

            <div class="timing-card closed">
              <img
                src="{{ url_for('static', filename='images/calender.png') }}"
                alt="Calendar Icon"
              />
              <div class="timing-details">
                <span>Sun</span>
                <p>Closed</p>
              </div>
            </div>
          </div>
        </div>

        <h2>Cubispace Advantage</h2>
        <div class="advantage-box">
          <div class="item">
            <i class="fas fa-tags"></i>Lowest Price Guaranteed
          </div>
          <div class="item">
            <i class="fas fa-clock-rotate-left"></i>Free Rescheduling
          </div>

          <div class="item">
            <i class="fas fa-calendar-xmark"></i>Free Cancellation
          </div>
          <div class="item">
            <i class="fas fa-bolt"></i>Instant Confirmations
          </div>
        </div>

        <h3>About</h3>
        <h4>Business Address Only - Center 57 | 1 sq ft</h4>
        <br />
        <p class="about-text">
          Located in the prime area of the royal city Lucknow, the first-born of
          Cubispace family holds a special space and is spread over 8000 sq ft.
        </p>
        <br />
        <p class="about-text">
          The convenient location and an array of amenities makes people feel
          like their own hub and matches with everyone‚Äôs vibes.
        </p>
        <br />
        <p class="about-text">
          The nearby affluent areas of Aliganj, Vikas Nagar, Mahanagar, New
          Lucknow University Campus, IIM College, and Sitapur Road will give you
          the promise of safety. With biophilic elements placed all over the
          space, the focus and zeal this place radiates will lead you on the
          path of growth.
        </p>
        <br />

        <section class="section">
          <div class="section-title">Amenities</div>
          <div class="card-grid">
            <div class="card">
              <i class="fas fa-wifi"></i>
              <h3>High Speed WiFi</h3>
            </div>
            <div class="card">
              <i class="fas fa-print"></i>
              <h3>Printer</h3>
            </div>
            <div class="card">
              <i class="fas fa-broom"></i>
              <h3>Housekeeping</h3>
            </div>
            <div class="card">
              <i class="fas fa-coffee"></i>
              <h3>Tea/Coffee</h3>
            </div>
            <div class="card">
              <i class="fas fa-door-open"></i>
              <h3>Meeting Rooms</h3>
            </div>
            <div class="card">
              <i class="fas fa-car"></i>
              <h3>Car / Bike Parking</h3>
            </div>
            <div class="card">
              <i class="fas fa-concierge-bell"></i>
              <h3>Reception</h3>
            </div>
            <div class="card">
              <i class="fas fa-phone"></i>
              <h3>Phone Booth</h3>
            </div>
            <div class="card">
              <i class="fas fa-chair"></i>
              <h3>Ergo Workstations</h3>
            </div>
            <div class="card">
              <i class="fas fa-utensils"></i>
              <h3>Pantry</h3>
            </div>
            <div class="card">
              <i class="fas fa-snowflake"></i>
              <h3>Air Conditioning</h3>
            </div>
            <div class="card">
              <i class="fas fa-couch"></i>
              <h3>Lounge</h3>
            </div>
          </div>
        </section>

        <section class="section">
          <div class="section-title">Community Events</div>
          <div class="card-grid">
            <div class="card">
              <i class="fas fa-lightbulb"></i>
              <h3>Innovation & Creativity</h3>
            </div>
            <div class="card">
              <i class="fas fa-chalkboard-teacher"></i>
              <h3>Workshop & Training</h3>
            </div>
            <div class="card">
              <i class="fas fa-users"></i>
              <h3>Meeting & Gatherings</h3>
            </div>
            <div class="card">
              <i class="fas fa-network-wired"></i>
              <h3>Networking Events</h3>
            </div>
            <div class="card">
              <i class="fas fa-people-arrows"></i>
              <h3>Community Building</h3>
            </div>
            <div class="card">
              <i class="fas fa-heart"></i>
              <h3>Health & Wellness</h3>
            </div>
          </div>
        </section>
      </div>

      {% if inventoryType in ["Day Pass", "Meeting Room"] %}
      <div class="container1" id="snt">
        <h3>Select your preference</h3>

        <div id="cartSummary" class="cart-summary">
          <div class="cart-header">
            <h4>Your Selection</h4>
          </div>
          <div class="cart-details">
            <p>
              <strong id="selectionLabel"></strong>
              <span id="totalPasses">1</span>
            </p>
            <p>
              <strong>Total Price:</strong> <span id="totalPrice">‚Çπ500</span>
            </p>
          </div>
          {% if inventoryType.lower() in ["day pass", "meeting room"] %}
          <div
            class="coupon-section"
            style="
              margin-top: 20px;
              padding: 15px;
              border: 1px solid #ccc;
              border-radius: 8px;
              background-color: #f9f9f9;
            "
          >
            <label
              for="coupon-select"
              style="font-weight: 600; display: block; margin-bottom: 6px"
              >Apply Coupon</label
            >
            <div
              style="
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 10px;
                align-items: center;
              "
            >
              <select
                class="coupon-select"
                style="
                  padding: 8px;
                  border: 1px solid #ccc;
                  border-radius: 4px;
                  min-width: 160px;
                  width: 100%;
                "
              >
                <option value="">-- Select Coupon --</option>
                <option value="FLAT100">FLAT100</option>
                {% if inventoryType == "Day Pass" %}
                <option value="DAY200">DAY200</option>
                <option value="DAY500">DAY500</option>
                {% elif inventoryType == "Meeting Room" %}
                <option value="MEET300">MEET300</option>
                <option value="MEET500">MEET500</option>
                {% endif %}
              </select>
              <button
                type="button"
                style="
                  padding: 8px 12px;
                  background-color: #4caf50;
                  color: white;
                  border: none;
                  border-radius: 4px;
                  width: 100%;
                "
                onclick="applyCoupon()"
              >
                Apply
              </button>
            </div>
            <p
              class="coupon-message"
              style="margin-top: 8px; font-size: 14px"
            ></p>
          </div>
          {% endif %}
          <div class="cart-footer">
            <button class="btn-cart-checkout" onclick="openBuyNowModal()">
              Proceed to Buy
            </button>
          </div>
        </div>

        <div class="pass-card1">
          <div class="left1">
            <span>{{ inventoryType }}</span>
            <div>
              <div class="price1" id="pr">
                ‚Çπ<span id="pricePerSeatDisplay">500</span>
              </div>
            </div>
          </div>
          <div class="quantity1">
            <button onclick="decreaseQuantity()">-</button>
            <span id="passQuantity">1</span>
            <button onclick="increaseQuantity()">+</button>
          </div>
        </div>

        <div class="bundle1" id="bundleOffers"></div>
      </div>
      {% endif %}
    </div>

    <div id="couponSuccessPopup" class="coupon-popup">
      <div class="coupon-popup-content">
        <span class="close-popup" onclick="closeCouponPopup()">&times;</span>
        <i class="fas fa-check-circle success-icon"></i>
        <p id="couponPopupMessage">Coupon applied successfully!</p>
      </div>
    </div>

    <div id="couponOverlay" class="modal-overlay" style="display: none"></div>

    <section class="space-location">
      <div class="content">
        <h1>Best Coworking Spaces in Jankipuram, Lucknow</h1>
        <p class="description">
          Located in the prime area of the royal city Lucknow, the first-born of
          Cubispace family holds a special space and is spread over 8000 sq. ft.
          The convenient location and an array of amenities makes people feel
          like their own hub and matches with everyone‚Äôs vibes. The nearby
          affluent areas of Aliganj, Vikas Nagar, Mahanagar, New Lucknow
          University Campus, IIM College, and Sitapur Road will give you the
          promise of safety. With biophilic elements placed all over the space,
          the focus and zeal this place radiates will lead you on the path of
          growth.
        </p>

        <div class="stats">
          <div class="stat">
            <h3>19 KM</h3>
            <p>Chaudhary Charan Singh International Airport</p>
          </div>
          <div class="stat">
            <h3>5 KM</h3>
            <p>Indira Nagar Metro Station</p>
          </div>
          <div class="stat">
            <h3>11 KM</h3>
            <p>Charbagh Railway Station</p>
          </div>
        </div>
      </div>
    </section>

    {% if contact %}
    <section class="related-products">
      <h2>Related Products</h2>
      <div class="product-grid">
        {% if inventoryType != "Day Pass" %}
        <div class="product-card">
          <img src="{{ property.property_images[0] }}" alt="Day Pass" />
          <h3>Day Pass</h3>
          <a
            href="{{ url_for('core_bp.cubispace') }}?contact={{ contact }}&inventory=daypass"
          >
            <button>Book Now</button>
          </a>
        </div>
        {% endif %} {% if inventoryType != "Meeting Room" or seater != "4" %}
        <div class="product-card">
          <img
            src="{{ property.property_images[1] }}"
            alt="4 Seater Meeting Room"
          />
          <h3>4 Seater Meeting Room</h3>
          <a
            href="{{ url_for('core_bp.cubispace') }}?contact={{ contact }}&inventory=meetingroom&seater=4"
          >
            <button>Book Now</button>
          </a>
        </div>
        {% endif %} {% if inventoryType != "Meeting Room" or seater != "6" %}
        <div class="product-card">
          <img
            src="{{ property.property_images[2] }}"
            alt="6 Seater Meeting Room"
          />
          <h3>6 Seater Meeting Room</h3>
          <a
            href="{{ url_for('core_bp.cubispace') }}?contact={{ contact }}&inventory=meetingroom&seater=6"
          >
            <button>Book Now</button>
          </a>
        </div>
        {% endif %} {% if inventoryType != "Meeting Room" or seater != "25" %}
        <div class="product-card">
          <img
            src="{{ property.property_images[3] }}"
            alt="25 Seater Meeting Room"
          />
          <h3>25 Seater Meeting Room</h3>
          <a
            href="{{ url_for('core_bp.cubispace') }}?contact={{ contact }}&inventory=meetingroom&seater=25"
          >
            <button>Book Now</button>
          </a>
        </div>
        {% endif %}
      </div>
    </section>
    {% endif %}

    <!-- <p class="more-info">
      For More Info

      <a href=""> Visit Findurspace</a>
    </p> -->

    <footer class="footer">
      <img src="../static/images/Logo.svg" alt="" class="footer-logo" /> <br />

      <div class="container">
        <!-- Contact Section -->
        <div class="footer-section contact">
          <h3>Contact us</h3>
          <p><i class="fas fa-phone"></i> +91 7897765559</p>
          <p><i class="fas fa-envelope"></i> hello@cubispace.com</p>
          <p>
            <i class="fas fa-map-marker-alt"></i>2nd Floor, JSV Hyundai Building
            CP-53 Sitapur Road Yojna, Near Engineering College Chauraha,
            Lucknow.
          </p>
        </div>

        <!-- Links Section -->
        <div class="footer-section links">
          <ul>
            <li><a href="{{ url_for('core_bp.freq_asked_ques') }}">FAQ</a></li>
            <li>
              <a href="{{ url_for('core_bp.terms_and_conditions') }}"
                >Terms & Conditions</a
              >
            </li>
            <li>
              <a href="{{ url_for('core_bp.privacy_policy') }}"
                >Privacy Policy</a
              >
            </li>
            <li>
              <a href="{{ url_for('core_bp.refund') }}"
                >Cancellation & Refund Policy</a
              >
            </li>
          </ul>
        </div>

        <!-- Social Media Section -->
        <!-- <div class="footer-section social">
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-linkedin"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
        </div> -->

        <!-- Newsletter Subscription -->
        <div class="footer-section newsletter">
          <h3>Powered By</h3>
          <img src="../static/images/1Asset 3-8.png" alt="" class="" />
        </div>
      </div>

      <!-- Copyright -->
      <div class="footer-bottom">
        <h5>CubiSpace ¬© 2021 All Right Reserved</h5>
        <p>Powered By Findurspace</p>
      </div>
    </footer>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  </body>

  <script>

        const images = {{ property.property_images|tojson }};
        let currentIndex = 0;

    const galleryImage = document.getElementById("galleryImage");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      function updateImage() {
        galleryImage.src = images[currentIndex];
      }

      nextBtn.addEventListener("click", () => {
        currentIndex = (currentIndex + 1) % images.length;
        updateImage();
      });

      prevBtn.addEventListener("click", () => {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        updateImage();
      });

      updateImage();

    document.addEventListener("DOMContentLoaded", () => {
      const modal = document.getElementById("popupModal");
      const inventorySelect = document.getElementById("inventory");
      const seaterGroup = document.getElementById("seaterGroup");
      const contactInput = document.getElementById("contact");
      const seaterSelect = document.getElementById("seater");

      const urlParams = new URLSearchParams(window.location.search);
      const urlContact = urlParams.get("contact");
      const verifiedContact = sessionStorage.getItem("verifiedContact");

      const inventory = urlParams.get("inventory");
      const seater = urlParams.get("seater");

      const invTypeEl = document.getElementById("dynamicInventoryType");
      const snt = document.getElementById("snt");
      // Check contact tampering
      const contactTampered = urlContact && verifiedContact && urlContact !== verifiedContact;

      if (contactTampered || !verifiedContact) {
      modal.style.display = "flex";
      sessionStorage.removeItem("verifiedContact");
      sessionStorage.removeItem("otpVerified");
    } else {
      // ‚úÖ Verified contact - proceed to prefill
      contactInput.value = verifiedContact;
      inventorySelect.value = inventory;

      if (inventory === "meetingroom") {
        seaterGroup.style.display = "block";
        seaterSelect.value = seater;
      }

      if (snt && (inventory === "meetingroom" || inventory === "daypass")) {
        snt.style.display = "block";
      }
    }

        const inventoryParam = urlParams.get("inventory");
        const seaterParam = urlParams.get("seater");

        if (inventoryParam === "meetingroom" && seaterParam) {
        invTypeEl.textContent = `${seaterParam} Seater Meeting Room`;
        } else if (inventoryParam === "daypass") {
        invTypeEl.textContent = "Day Pass";
        }

        // Show preference section if applicable
      if (snt && (inventory === "meetingroom" || inventory === "daypass")) {
        snt.style.display = "block";
      }

      const otpVerified = sessionStorage.getItem("otpVerified") === "true";

      if (!contact || !inventory || (inventory === "meetingroom" && !seater)) {
              modal.style.display = "flex";
            } else {
              // contactInput.value = contact;
              contactInput.value = sessionStorage.getItem("verifiedContact") || "";
              if (isOtpVerified) {
      inventorySelect.value = inventory;

      if (inventory === "meetingroom") {
        seaterGroup.style.display = "block";
        seaterSelect.value = seater;
      }

      inventorySection.style.display = "block";
      submitBtn.style.display = "inline-block";
    }
            }

      inventorySelect.addEventListener("change", () => {
        seaterGroup.style.display = inventorySelect.value === "meetingroom" ? "block" : "none";
      });

      // Block outside click unless form is filled
      window.onclick = (e) => {
              if (e.target === modal) {
                const contactVal = contactInput.value.trim();
                const inventoryVal = inventorySelect.value;
                const seaterVal = seaterSelect.value;
                const isIncomplete = !contactVal || !inventoryVal || (inventoryVal === "meetingroom" && !seaterVal);
                if (isIncomplete) alert("Please fill all required fields.");
              }
            };

      // Prevent close button from closing modal
      document.querySelector(".close").onclick = (e) => {
              const contactVal = contactInput.value.trim();
              const inventoryVal = inventorySelect.value;
              const seaterVal = seaterSelect.value;
              const isIncomplete = !contactVal || !inventoryVal || (inventoryVal === "meetingroom" && !seaterVal);
              if (isIncomplete) {
                alert("Please fill all required fields.");
                e.preventDefault();
              }
            };


      // Form submission
      document.getElementById("popupForm").addEventListener("submit", (e) => {
              e.preventDefault();
              const contactVal = contactInput.value.trim();
              const inventoryVal = inventorySelect.value;
              const seaterVal = seaterSelect.value;

              if (!contactVal || !inventoryVal || (inventoryVal === "meetingroom" && !seaterVal)) {
                alert("Please fill all required fields.");
                return;
              }

              if (!isOtpVerified) {
                alert("Please verify OTP before proceeding.");
                return;
              }

              const url = new URL(window.location.href.split("?")[0]);
              const verifiedContact = sessionStorage.getItem("verifiedContact");
              url.searchParams.set("contact", verifiedContact);
              url.searchParams.set("inventory", inventoryVal);
              if (inventoryVal === "meetingroom") {
                url.searchParams.set("seater", seaterVal);
              }

              fetch('/update_user_details', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  phone: verifiedContact,
                  inventory_type: inventoryVal,
                  seater: seaterVal || null
                })
              });

              window.location.href = url.toString();
            });
          });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let passQuantity = 1;
      const inventoryType = "{{ inventoryType }}";
      let pricePerSeat = {{ price_value | int }};

      // Update base price display if element exists
      const priceDisplay = document.getElementById("pricePerSeatDisplay");
      if (priceDisplay) {
        priceDisplay.innerText = pricePerSeat;
      }

      function updateCartSummary() {
        const cart = document.querySelector("#cartSummary");
        if (cart) cart.style.display = "block";

        document.querySelector("#passQuantity").innerText = passQuantity;
        document.querySelector("#totalPasses").innerText = `${passQuantity}`;
        document.querySelector("#totalPrice").innerText = `‚Çπ${pricePerSeat * passQuantity}`;
      }

      function increaseQuantity() {
        resetCoupon();
        passQuantity++;
        updateCartSummary();
        updateCouponColors(); // üîÅ call here
      }

      function decreaseQuantity() {
        resetCoupon(); // üîÅ Reset coupon
        if (passQuantity > 1) {
          passQuantity--;
          updateCartSummary();
          updateCouponColors(); // üîÅ call here
        }
      }

      function addBundle(quantity) {
        resetCoupon(); // üîÅ Reset coupon
        passQuantity = quantity;
        updateCartSummary();
        updateCouponColors(); // üîÅ call here
      }

      // Attach functions to global scope for inline button calls
      window.increaseQuantity = increaseQuantity;
      window.decreaseQuantity = decreaseQuantity;
      window.addBundle = addBundle;

      // Auto-render bundles
      updateCartSummary();
      updateCouponColors(); // üîÅ call here

      const bundleOffers = document.getElementById("bundleOffers");
      if (bundleOffers) {
        let bundleHTML = "";

        if (inventoryType === "Meeting Room") {
          bundleHTML = `
            <div class="bundle1">
              <div><strong>2 Hours</strong><div class="price1">‚Çπ${2 * pricePerSeat}</div></div>
              <button class="btn1 btn-add1" onclick="addBundle(2)">Add</button>
          </div>
          <div class="bundle1">
              <div><strong>4 Hours</strong><div class="price1">‚Çπ${4 * pricePerSeat}</div></div>
              <button class="btn1 btn-add1" onclick="addBundle(4)">Add</button>
          </div>`;
        } else if (inventoryType === "Day Pass") {
          bundleHTML = `
             <div class="bundle1">
          <div><strong>5 Days</strong><div class="price1">‚Çπ${5 * pricePerSeat}</div></div>
          <button class="btn1 btn-add1" onclick="addBundle(5)">Add</button>
        </div>
        <div class="bundle1">
          <div><strong>10 Days</strong><div class="price1">‚Çπ${10 * pricePerSeat}</div></div>
          <button class="btn1 btn-add1" onclick="addBundle(10)">Add</button>
        </div>`;
        }

        bundleOffers.innerHTML = bundleHTML;
      }

      // Update label
      const label = inventoryType === "Meeting Room" ? "Meeting Room Hours:" : "Day Passes:";
      const labelEl = document.getElementById("selectionLabel");
      if (labelEl) {
        labelEl.innerText = label;
      }
    });
  </script>
  <script>
    let passQuantity = 1;
    let pricePerSeat = {{ price_value | int }};
    let totalPrice = pricePerSeat;// will update dynamically

    function openBuyNowModal() {
      // Auto-fill phone
        const verifiedPhone = sessionStorage.getItem("verifiedContact");
        if (verifiedPhone) {
          const phoneInput = document.getElementById("phoneBuy");
          phoneInput.value = verifiedPhone;
          phoneInput.readOnly = true;
        }

        passQuantity = parseInt(document.getElementById("passQuantity").innerText);
const basePrice = pricePerSeat * passQuantity;
const gstAmount = Math.round(basePrice * 0.18);
const priceWithGST = basePrice + gstAmount;

// Determine discount based on coupon
let appliedCoupon = document.querySelector(".coupon-select")?.value || "";
let discount = 0;

if (appliedCoupon === "FLAT100") discount = 100;
if (appliedCoupon === "DAY200" && passQuantity >= 5) discount = 200;
if (appliedCoupon === "DAY500" && passQuantity >= 10) discount = 500;
if (appliedCoupon === "MEET300" && passQuantity >= 2) discount = 300;
if (appliedCoupon === "MEET500" && passQuantity >= 4) discount = 500;

const finalAmount = priceWithGST - discount;

// Update Modal Values
document.getElementById("modalPassQuantity").innerText = passQuantity;
document.getElementById("modalBasePrice").innerText = basePrice;
document.getElementById("modalGST").innerText = gstAmount;
document.getElementById("modalPriceWithGST").innerText = priceWithGST;
document.getElementById("modalDiscount").innerText = discount;
document.getElementById("modalTotalPrice").innerText = finalAmount;

        const dateInput = document.getElementById("buyNowDate");

        // Set min to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        dateInput.min = tomorrow.toISOString().split("T")[0];

        // Disable Sundays using input event
        dateInput.addEventListener("input", function () {
          const selected = new Date(this.value);
          if (selected.getDay() === 0) { // Sunday = 0
            alert("Booking not available on Sundays. Please choose another date.");
            this.value = ""; // Clear the invalid selection
          }
        });

        document.getElementById("buyNowModal").style.display = "flex";
        document.getElementById("modalOverlay").style.display = "block";

        const urlParams = new URLSearchParams(window.location.search);
        const inventory = urlParams.get("inventory");

        if (inventory === "meetingroom") {
            document.getElementById("timeSelectionContainer").style.display = "block";
            generateTimeSlots();
        } else {
            document.getElementById("timeSelectionContainer").style.display = "none";
        }
    }

    // Initialize flatpickr on date field
    flatpickr("#buyNowDate", {
      dateFormat: "Y-m-d",
      minDate: "today",
      disable: [
        function(date) {
          // Disable Sundays
          return date.getDay() === 0;
        }
      ]
    });

    function closeBuyNowModal() {
        document.getElementById("buyNowModal").style.display = "none";
        document.getElementById("modalOverlay").style.display = "none";
    }

    function generateTimeSlots() {
      const timeSlotDropdown = document.getElementById("timeSlotDropdown");
      timeSlotDropdown.innerHTML = `<option value="">Select Time Slot</option>`;

      const startHour = 9;
      const endHour = 21;

      for (let hour = startHour; hour < endHour; hour++) {
        const startTime = formatHour(hour);
        const endTime = formatHour(hour + 1);
        const label = `${startTime} to ${endTime}`;

        const option = document.createElement("option");
        option.value = label;
        option.textContent = label;
        timeSlotDropdown.appendChild(option);
      }
    }

    function formatHour(hour) {
      const period = hour >= 12 ? "PM" : "AM";
      const formattedHour = hour % 12 === 0 ? 12 : hour % 12;
      return `${formattedHour}:00 ${period}`;
    }

    // function submitPurchase() {
    //     const fullName = document.getElementById("fullNameBuy").value;
    //     const email = document.getElementById("emailBuy").value;
    //     const phone = document.getElementById("phoneBuy").value;
    //     const company = document.getElementById("companyBuy").value;
    //     const gstin = document.getElementById("gstinBuy").value;
    //     const selectedDate = document.getElementById("buyNowDate").value;
    //     const selectedTime = document.getElementById("timeSlotDropdown").value;
    //     const inventoryType = "{{ inventoryType }}";
    //     const propertyId = "{{ property['_id'] }}";

    //     if (!fullName || !email || !phone || !selectedDate) {
    //         alert("Please fill all required fields.");
    //         return;
    //     }

    //     if (inventoryType === "Meeting Room" && !selectedTime) {
    //         alert("Please select a time slot.");
    //         return;
    //     }

    //     const payload = {
    //         inventoryType: inventoryType,
    //         quantity: passQuantity,
    //         totalPrice: discountedTotal !== null ? discountedTotal : totalPrice,
    //         fullName: fullName,
    //         email: email,
    //         phone: phone,
    //         company: company,
    //         gstin: gstin || null,
    //         date: selectedDate,
    //         time: inventoryType === "Meeting Room" ? selectedTime : null,
    //         property_id: propertyId
    //     };

    //     fetch("/submit_purchase", {
    //         method: "POST",
    //         headers: { "Content-Type": "application/json" },
    //         body: JSON.stringify(payload)
    //     })
    //     .then(res => res.json())
    //     .then(data => {
    //         if (data.success) {
    //             closeBuyNowModal();
    //             document.getElementById("thankYouOverlay").style.display = "block"; // Show overlay
    //   document.getElementById("thankYouModal").style.display = "flex";    // Show modal
    //         } else {
    //             alert("Error: " + data.message);
    //         }
    //     })
    //     .catch(err => {
    //         console.error("Error submitting:", err);
    //         alert("Something went wrong.");
    //     });
    // }

    function submitPurchase() {
      const fullName = document.getElementById("fullNameBuy").value;
      const email = document.getElementById("emailBuy").value;
      const phone = sessionStorage.getItem("verifiedContact") || document.getElementById("phoneBuy").value;
      document.getElementById("phoneBuy").value = phone;
      document.getElementById("phoneBuy").readOnly = true;
      const company = document.getElementById("companyBuy").value;
      const gstin = document.getElementById("gstinBuy").value;
      const selectedDate = document.getElementById("buyNowDate").value;
      const selectedTime = document.getElementById("timeSlotDropdown").value;
      const inventoryType = "{{ inventoryType }}";
      const propertyId = "{{ property['_id'] }}";

      if (!fullName || !email || !phone || !selectedDate) {
        alert("Please fill all required fields.");
        return;
      }

      if (inventoryType === "Meeting Room" && !selectedTime) {
        alert("Please select a time slot.");
        return;
      }

      passQuantity = parseInt(document.getElementById("passQuantity").innerText);
const basePrice = pricePerSeat * passQuantity;
const gstAmount = Math.round(basePrice * 0.18);
const priceWithGST = basePrice + gstAmount;

// Calculate discount again based on coupon
let appliedCoupon = document.querySelector(".coupon-select")?.value || "";
let discount = 0;

if (appliedCoupon === "FLAT100") discount = 100;
if (appliedCoupon === "DAY200" && passQuantity >= 5) discount = 200;
if (appliedCoupon === "DAY500" && passQuantity >= 10) discount = 500;
if (appliedCoupon === "MEET300" && passQuantity >= 2) discount = 300;
if (appliedCoupon === "MEET500" && passQuantity >= 4) discount = 500;

const finalAmount = priceWithGST - discount;

      

      // STEP 1: Call backend to create Razorpay order
      fetch("/create_order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          amount: finalAmount , // Razorpay expects amount in paise
          currency: "INR",
          receipt: `booking_${Date.now()}`,
        }),
      })
        .then((res) => res.json())
        .then((orderData) => {
          if (!orderData.success) {
            console.log("Failed to initiate payment.");
            return;
          }

          // STEP 2: Open Razorpay Payment UI
          const options = {
            key: "{{ razorpay_key }}", // passed from Flask context
            amount: orderData.amount,
            currency: orderData.currency,
            name: "CubiSpace",
            description: "Booking Payment",
            image: "../static/images/Logo.svg",
            order_id: orderData.id,
            handler: function (response) {
              // STEP 3: On payment success, confirm booking
              const payload = {
                inventoryType: inventoryType,
                quantity: passQuantity,
                totalPrice: finalAmount,
                fullName: fullName,
                email: email,
                phone: phone,
                company: company,
                gstin: gstin || null,
                date: selectedDate,
                time: inventoryType === "Meeting Room" ? selectedTime : null,
                property_id: propertyId,
                razorpay_payment_id: response.razorpay_payment_id,
                razorpay_order_id: response.razorpay_order_id,
                razorpay_signature: response.razorpay_signature,
                status: "Paid"
              };

              fetch("/submit_purchase", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              })
                .then((res) => res.json())
                .then((data) => {
                  if (data.success) {
                    closeBuyNowModal();
                    document.getElementById("thankYouOverlay").style.display = "block";
                    document.getElementById("thankYouModal").style.display = "flex";
                  } else {
                    console.log("Booking failed: " + data.message);
                  }
                });
            },
            prefill: {
              name: fullName,
              email: email,
              contact: phone,
            },
            theme: {
              color: "#3399cc",
            },
            modal: {
            // ‚úÖ Handle modal close without payment
            ondismiss: function () {
              const cancelPayload = {
                inventoryType,
                quantity: passQuantity,
                totalPrice: finalPrice,
                fullName,
                email,
                phone,
                company,
                gstin: gstin || null,
                date: selectedDate,
                time: inventoryType === "Meeting Room" ? selectedTime : null,
                property_id: propertyId,
                status: "Exit"
              };

              fetch("/submit_purchase", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(cancelPayload)
              })
              .then(() => {
                console.log("Payment window closed. Booking info saved as exit.");
              })
              .catch(() => {
                console.log("Failed to save cancelled booking.");
              });
              }
            }
          };
          
          const rzp = new Razorpay(options);
          // ‚úÖ Handle payment failure and store failed booking
          rzp.on('payment.failed', function (response) {
            const failedPayload = {
              inventoryType,
              quantity: passQuantity,
              totalPrice: finalPrice,
              fullName,
              email,
              phone,
              company,
              gstin: gstin || null,
              date: selectedDate,
              time: inventoryType === "Meeting Room" ? selectedTime : null,
              property_id: propertyId,
              razorpay_payment_id: response.error.metadata.payment_id,
              razorpay_order_id: response.error.metadata.order_id,
              status: "Failed"
            };

            fetch("/submit_purchase", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(failedPayload)
          })
          .then(() => {
            console.log("Payment failed or was cancelled.");
          })
          .catch(() => {
            console.log("Something went wrong after payment failure.");
          });
        });
          rzp.open();
        })
        .catch((err) => {
          console.error("Error in payment:", err);
          console.log("Payment initiation failed.");
        });
    }


    function closeThankYouModal() {
      document.getElementById("thankYouModal").style.display = "none";
      document.getElementById("thankYouOverlay").style.display = "none";
    }
  </script>

  <script>
    let discountedTotal = null;

    // Function to show success popup
    function applyCoupon() {
      const inventoryType = "{{ inventoryType }}";
      const quantity = parseInt(
        document.getElementById("passQuantity").innerText
      );
      const couponDropdown = document.querySelector(".coupon-select");
      const selectedCoupon = couponDropdown.value;
      const messageEl = document.querySelector(".coupon-message");

      let valid = false;
      let discount = 0;
      let message = "";
      let errorColor = "red";

      switch (selectedCoupon) {
        case "FLAT100":
          valid = true;
          discount = 100;
          message = "Flat ‚Çπ100 off applied!";
          break;

        case "DAY200":
          if (inventoryType === "Day Pass" && quantity >= 5) {
            valid = true;
            discount = 200;
            message = "‚Çπ200 off for 5+ Day Passes!";
          } else {
            message = "Coupon Applicable on 5 Day Passes.";
          }
          break;

        case "DAY500":
          if (inventoryType === "Day Pass" && quantity >= 10) {
            valid = true;
            discount = 500;
            message = "‚Çπ500 off for 10+ Day Passes!";
          } else {
            message = "Coupon Applicable on 10 Day Passes.";
          }
          break;

        case "MEET300":
          if (inventoryType === "Meeting Room" && quantity >= 2) {
            valid = true;
            discount = 300;
            message = "‚Çπ300 off for 2+ Meeting Hours!";
          } else {
            message = "Coupon Applicable on 2 Meeting Hours.";
          }
          break;

        case "MEET500":
          if (inventoryType === "Meeting Room" && quantity >= 4) {
            valid = true;
            discount = 500;
            message = "‚Çπ500 off for 4+ Meeting Hours!";
          } else {
            message = "Coupon Applicable on 4 Meeting Hours.";
          }
          break;

        default:
          message = "Invalid or unsupported coupon.";
          break;
      }

      if (valid) {
        discountedTotal = pricePerSeat * quantity - discount;

        document.getElementById("totalPrice").innerHTML = `
      <span style="text-decoration:line-through; color:#999;">‚Çπ${
        pricePerSeat * quantity
      }</span>
      <span style="margin-left:8px; color:green;">‚Çπ${discountedTotal}</span>
    `;

        document.getElementById("modalTotalPrice").innerText = discountedTotal;

        messageEl.innerText = message;
        messageEl.style.color = "green";
        showCouponSuccessPopup(message);
      } else {
        discountedTotal = null;
        messageEl.innerText = message;
        messageEl.style.color = errorColor;
      }
    }

    function updateCouponColors() {
      const inventoryType = "{{ inventoryType }}";
      const quantity = parseInt(
        document.getElementById("passQuantity").innerText
      );
      const couponOptions = document.querySelectorAll(".coupon-select option");

      couponOptions.forEach((option) => {
        const code = option.value;
        let isValid = false;

        switch (code) {
          case "FLAT100":
            isValid = true;
            break;
          case "DAY200":
            isValid = inventoryType === "Day Pass" && quantity >= 5;
            break;
          case "DAY500":
            isValid = inventoryType === "Day Pass" && quantity >= 10;
            break;
          case "MEET300":
            isValid = inventoryType === "Meeting Room" && quantity >= 2;
            break;
          case "MEET500":
            isValid = inventoryType === "Meeting Room" && quantity >= 4;
            break;
          default:
            break;
        }

        option.style.color = isValid ? "green" : code ? "red" : "#000";
      });
    }

    function resetCoupon() {
      discountedTotal = null;

      // Reset dropdown selection
      document.querySelectorAll(".coupon-select").forEach((select) => {
        select.value = "";
      });

      // Reset price display
      const quantity = parseInt(
        document.getElementById("passQuantity").innerText
      );
      document.getElementById("totalPrice").innerText = `‚Çπ${
        pricePerSeat * quantity
      }`;

      // Clear all coupon messages
      document.querySelectorAll(".coupon-message").forEach((msg) => {
        msg.innerText = "";
        msg.style.color = "";
      });
    }

    function showCouponSuccessPopup(message) {
      const popup = document.getElementById("couponSuccessPopup");
      const overlay = document.getElementById("couponOverlay");
      const msgBox = document.getElementById("couponPopupMessage");

      msgBox.innerText = message;
      popup.style.display = "block";
      overlay.style.display = "block";

      setTimeout(() => {
        popup.style.display = "none";
        overlay.style.display = "none";
      }, 5000);
    }

    function closeCouponPopup() {
      document.getElementById("couponSuccessPopup").style.display = "none";
      document.getElementById("couponOverlay").style.display = "none";
    }
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const bookNowBtn = document.getElementById("bookNowBtn");
      const popupModal = document.getElementById("popupModal");

      if (bookNowBtn && popupModal) {
        bookNowBtn.addEventListener("click", (e) => {
          e.preventDefault();
          popupModal.style.display = "flex";
        });
      }
    });
  </script>
  <script>
    let isOtpVerified = false; // ‚úÖ Track OTP status
    // Load OTPless SDK
    let OTPlessSignin = null;

    async function OTPlessSdk() {
      return new Promise((resolve) => {
        if (window.OTPless && OTPlessSignin) return resolve();

        const script = document.createElement("script");
        script.src = "https://otpless.com/v4/headless.js";
        script.id = "otpless-sdk";
        script.setAttribute("data-appid", "DMQXR10UUDL7DTU6326R");

        script.onload = () => {
          if (window.OTPless) {
            OTPlessSignin = new OTPless();
            resolve();
          }
        };

        document.head.appendChild(script);
      });
    }

    let resendTimer;
    async function initiateOtp() {
      const phone = document.getElementById("contact").value.trim();
      if (!/^\d{10}$/.test(phone)) return alert("Enter valid 10-digit number");

      await OTPlessSdk();

      const res = await OTPlessSignin.initiate({
        channel: "PHONE",
        phone,
        countryCode: "+91",
        expiry: "60",
      });

      if (res.success) {
        document.getElementById("otpSection").style.display = "block";
        showOtpMessage("OTP sent successfully!", "success");
        startResendCountdown();
      } else {
        showOtpMessage("Failed to send OTP. Try again.", "danger");
      }
    }

    async function verifyOtp() {
      const phone = document.getElementById("contact").value.trim();
      const otp = document.getElementById("otpInput").value.trim();

      if (!/^\d{6}$/.test(otp)) {
        showOtpMessage("Invalid OTP format", "danger");
        return;
      }

      await OTPlessSdk();

      const result = await OTPlessSignin.verify({
        channel: "PHONE",
        phone,
        otp,
        countryCode: "+91",
      });

      if (result.success) {
        isOtpVerified = true;
        window.verifiedContact = phone;
        // ‚úÖ Save in sessionStorage
        sessionStorage.setItem("verifiedContact", phone);
        sessionStorage.setItem("otpVerified", "true");
      
        // Inside result.success block:
        showOtpMessage("OTP verified!", "success");

        fetch('/save_user_contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone })
        });

        // ‚úÖ Lock contact input
        document.getElementById("contact").readOnly = true;

        // ‚úÖ Hide OTP section and buttons
        document.getElementById("sendOtpBtn").style.display = "none";
        document.getElementById("verifyOtpBtn").style.display = "none";
        document.getElementById("otpSection").style.display = "none";

        // ‚úÖ Show inventory selection
        document.getElementById("inventorySection").style.display = "block";
        document.getElementById("submitBtn").style.display = "inline-block";
      } else {
        isOtpVerified = false;
        // Inside result.error:
        showOtpMessage("OTP verification failed.", "danger");
      }
    }

    async function resendOtp() {
      const phone = document.getElementById("contact").value.trim();
      if (!/^\d{10}$/.test(phone))
        return showOtpMessage("Enter valid 10-digit number", "danger");

      await OTPlessSdk();
      const res = await OTPlessSignin.initiate({
        channel: "PHONE",
        phone,
        countryCode: "+91",
        expiry: "60",
      });

      if (res.success) {
        showOtpMessage("OTP resent successfully!", "success");
        startResendCountdown();
      } else {
        showOtpMessage("Failed to resend OTP", "danger");
      }
    }

    function startResendCountdown() {
      let counter = 60;
      const resendBtn = document.getElementById("resendOtpBtn");

      resendBtn.disabled = true;
      resendBtn.style.backgroundColor = "#ccc";
      resendBtn.style.color = "#666";
      resendBtn.style.cursor = "not-allowed";
      resendBtn.textContent = `Resend OTP (${counter}s)`;

      clearInterval(resendTimer);
      resendTimer = setInterval(() => {
        counter--;
        resendBtn.textContent = `Resend OTP (${counter}s)`;

        if (counter <= 0) {
          clearInterval(resendTimer);
          resendBtn.disabled = false;
          resendBtn.textContent = "Resend OTP";
          resendBtn.style.backgroundColor = "#4CAF50";
          resendBtn.style.color = "#fff";
          resendBtn.style.cursor = "pointer";
        }
      }, 1000);
    }

    function showOtpMessage(msg, type = "info") {
      const el = document.getElementById("otpMessage");
      el.textContent = msg;
      el.style.display = "block";

      el.classList.remove("otp-success", "otp-error", "otp-info");

      switch (type) {
        case "success":
          el.classList.add("otp-success");
          break;
        case "danger":
          el.classList.add("otp-error");
          break;
        default:
          el.classList.add("otp-info");
      }
    }

    // Make global
    window.initiateOtp = initiateOtp;
    window.verifyOtp = verifyOtp;
  </script>

  <!-- Google Tag Manager (noscript) -->
  <noscript
    ><iframe
      src="https://www.googletagmanager.com/ns.html?id=GTM-MX8P4NN6"
      height="0"
      width="0"
      style="display: none; visibility: hidden"
    ></iframe
  ></noscript>
  <!-- End Google Tag Manager (noscript) -->
</html>
