<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags and Title -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta description="List your property effortlessly on Findurspace. Reach potential tenants quickly with our easy-to-use platform for commercial and residential spaces.">
    <link rel="canonical" href="https://findurspace.tech/list-your-space" />
    <title>List Your Coworking Space - FindUrSpace</title>
    <link rel="icon" href="../static/images/Asset 6.png" type="image/x-icon">

    <!-- Schema Markup for Organization -->
    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "FindUrSpace",
      "url": "https://findurspace.tech",
      "logo": "https://findurspace.tech/static/images/logo.png",
      "contactPoint": [{
        "@type": "ContactPoint",
        "contactType": "Customer Service",
        "url": "https://findurspace.tech/contact",
        "areaServed": "India"
      }]
    }
    </script>

    <!-- Parsley CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/parsleyjs/src/parsley.css">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FontAwesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Optional: Include your own CSS for additional styling -->
    <style>
    /* General Body Styling */

    #no{
        flex-wrap:nowrap !important;
        align-items: flex-start;
    }
    body {
        background-color: #ffffff; /* Light background */
        color: #333; /* Darker text for readability */
    }

    .container {
        max-width: 800px;
        margin-top: 40px;
        margin-bottom: 40px;
    }

    .add-space-button{
        background-color: #151d31;
        color:white;
        padding:8px 15px;
        font-weight: 700;
        border:2px solid #151d31;
    }

    .add-space-button:hover{
        background-color: white;
        color:#151d31;
        border:2px solid #151d31;
        padding:8px 15px;
        font-weight: 700;
    }

    .add-space-button:active{
        background-color: #151d31;
        color:white;
        padding:8px 15px;
        font-weight: 700;
        border:2px solid #151d31;
    }

    .submit-btn{
        display:block;
        width:100%;
    }

    .card {
        margin-bottom: 40px;
        border:2px solid #151d31;
        border-radius: 15px;
    }
    .card-header{
        background-color: #151d31;
        color:white;
        border-radius: 15px;
        font-weight: 600;
        font-size: 20px;
        padding:10px 20px;
    }

    .card-body{
        display:flex;
        flex-direction: column;
        gap: 0px;
    }

    .btn-close{
        color:black;
        position:absolute;
        top:0;
        right:0;
    }
    /* Centered Button */
    .centered-button {
        display: block; /* Center the button */
        margin: 0 auto;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        background-color: #28a745; /* Green background */
        color: white;
        border: 2px solid #28a745;
        width: auto;
        text-align: center;
        cursor: pointer;
    }

    .centered-button:hover {
        background-color: #218838; /* Darker green on hover */
        border-color: #218838;
    }

    /* Delete Button */
    .delete-button {
        background: none;
        border: none;
        color: white;
        background-color:red;
        padding:5px 18px;
        border-radius: 1000px;
        font-size: 24px;
        margin-right: 10px;
        cursor: pointer;
        border:2px solid white;
    }

    .delete-button:hover {
        color: red;
        background-color: white;
        border:2px solid red;
    }

    /* Image Preview Styles */
    .preview-img-container {
        position: relative;
        display: inline-block;
        margin-right: 10px;
        margin-bottom: 10px;
    }

    .preview-img {
        max-width: 100px;
        cursor: pointer;
        border: 2px solid #ddd;
        border-radius: 5px;
    }

    .preview-img-container .delete-button {
        position: absolute;
        top: -10px;
        right: -10px;
        background-color: red;
        color: white;
        border: 1px solid red;
        font-size: 20px;
        border-radius: 50%;
        padding: 0 10px;
        cursor: pointer;
    }

    
    /* General Input Styling */
    input, select, textarea {
        border: 2px solid #ccc; /* Default neutral border color */
        background-color: #f8f9fa; /* Light gray background */
        transition: background-color 0.3s ease, border-color 0.3s ease; /* Smooth transition */
    }

    /* Input Validation Styling */
    input.parsley-error,
    select.parsley-error,
    textarea.parsley-error {
        border: 2px solid #dc3545; /* Use Bootstrap's danger color */
        background-color: #fff1f2; /* Light red background */
        position: relative;
    }

    /* Placeholder as Error Message Inside Input Field */
    input.parsley-error::placeholder,
    select.parsley-error::placeholder,
    textarea.parsley-error::placeholder {
        color: #dc3545; /* Red placeholder for error message */
        opacity: 1; /* Ensure full visibility of the error message */
    }

    /* On hover, change input border color */
    input.parsley-error:hover,
    select.parsley-error:hover,
    textarea.parsley-error:hover {
        border-color: #e63946; /* Slightly darker red on hover */
    }

    /* Success Input Fields */
    input.parsley-success,
    select.parsley-success,
    textarea.parsley-success {
        border: 2px solid #ccc; 
        background-color: #f8f9fa; /* Light green background */
    }

    /* Error Message Styling */
    .parsley-errors-list {
        margin-top: 5px; /* Space between input and error message */
        color: #dc3545; /* Bootstrap's danger color */
        font-size: 0.875rem; /* Slightly smaller font size */
        font-weight: bold;
        list-style-type: none; /* No bullet points */
        padding-left: 0; /* No padding */
        position: relative; /* Ensure it stays relative to input */
        display: block; /* Force the error message to appear below */
        width: 100%; /* Make sure it takes up full width below the input */
        min-height: 1.2em; /* Reserve space for error messages */
    }

    /* Form Fields Two per Row */
    .form-group {
        display: flex;
        gap: 15px;
        align-items: flex-start; /* Align inputs and error messages */
    }

    .form-group .form-control {
        flex: 1;
        margin-top:4px;
    }

    /* Inventory Item Layout */
    .inventory-item .form-select,
    .inventory-item .form-control {
        flex: 1;
    }

    .inventory-item .form-group {
        align-items: flex-start;
    }

    .inventory-item {
        border-top: 1px solid #ddd;
        padding-top: 15px;
        margin-top: 15px;
    }

    /* For Small Screens, Stack Fields Vertically */
   /* Full Width Form Fields on Small Screens */
@media (max-width: 576px) {
    .form-group {
        flex-direction: column;
        width: 100%;
    }

    .form-group .form-control,
    .form-group .form-select {
        width: 100%;
        box-sizing: border-box;
    }

    .d-flex {
        flex-direction: column;
        width: 100%;
    }

    .d-flex .form-control,
    .d-flex .form-select {
        width: 100%;
        box-sizing: border-box;
    }
}

    /* File Format Note */
    .file-format-note {
        font-size: 0.875rem;
        color: #6c757d;
        margin-top:-10px;
        font-weight: 600;
    }

    .team{
        margin-top: 10px;
    }

    .amen{
        margin-top:10px;
        font-size:22px;
        font-weight: 600;
    }
    /* Loading Spinner Styles */
    #loadingSpinner {
        display: none;
        text-align: center;
        margin: 20px 0;
    }

    /* Flash Messages Styling */
    .flash-message {
        padding: 10px 20px;
        border-radius: 5px;
    }

    .flash-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .flash-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    /* Current Location Button Styling */
    .current-location-btn {
        background-color: #151d31;
        color: white;
        font-weight: bold;
        border: 2px solid white;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
    }

    /* Hover Effect - Scale, Color Change, and Icon Animation */
    .current-location-btn:hover {
        background-color: #1e2a4a;
        color: white;
        box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.3);
    }

    /* Pin Icon Animation */
    .current-location-btn:hover .pin-icon {
        animation: bounce 0.5s infinite alternate;
    }

    /* Keyframe Animation for Pin Icon */
    @keyframes bounce {
        0% {
            transform: translateY(0);
        }
        100% {
            transform: translateY(-5px);
        }
    }

    /* Modal Close Button - Matches Small Image Preview Close Button */
.modal-close-button {
    background: red;
    color: white;
    border: 2px solid white;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    font-size: 20px;
    line-height: 22px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* Hover Effect for Modal Close Button */
.modal-close-button:hover {
    background: white;
    color: red;
    border: 2px solid red;
}

.amenity-icon {
    font-size: 1.2em;
    margin-right: 8px;
    vertical-align: middle;
    color: #5A5A5A;
}

.form-check-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
}

.rowamen {
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    justify-content: flex-start;
}

.col-md-4-amen {
    display: flex;
}

.off{
    margin-top: 20px;
    font-size:22px;
    font-weight:600;
}

.hour{
    font-size:18px;
    font-weight:600;
}

.tell{
    margin-top:20px;
}

.head{
    color:#151d31;
    display: block;
    padding:6px 15px;
    font-weight: 700;
    border-radius: 8px;
    text-align: center;
    margin:0 auto;
}

/* Responsive Amenities Grid */
@media (max-width: 768px) {
    .rowamen {
        grid-template-columns: repeat(2, 1fr) !important; /* 2 columns on smaller screens */
    }
}
@media (max-width:480px) {
    .rowamen {
        grid-template-columns: repeat(1, 1fr) !important; /* 2 columns on smaller screens */
    }
}

/* General Body Styling */
body {
    background-color: #f4f7fc;
    color: #333;
    font-family: 'Roboto', sans-serif;
    line-height: 1.6;
}

.container {
    max-width: 800px;
    margin: 40px auto;
    padding: 20px;
    background: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
}

/* Card Styling */
.card {
    margin-bottom: 40px;
    border: 1px solid #e1e4e8;
    border-radius: 15px;
    background: #fff;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}

.card:hover {
    transform: scale(1.02);
}

.card-header {
    background-color: #151d31;
    color: #fff;
    border-radius: 15px;
    font-weight: 700;
    font-size: 24px;
    padding: 15px 20px;
    text-align: center;
}

.card-body {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 0px;
}

/* Button Styles */
.centered-button {
    display: block;
    width:100%;
    border:2px solid #151d31;
    border-radius: 5px;
    font-size: 18px;
    background-color: #151d31;
    color: white;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.centered-button:hover {
    background-color: white;
    color:#151d31;
    border:2px solid #151d31;
    font-weight: 600;;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

/* Input Fields */
input, select, textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #ccc;
    border-radius: 5px;
    background-color: #f8f9fa;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

input:focus, select:focus, textarea:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
}

/* Typography and Labels */
label {
    font-weight: 600;
    color: #555;
    margin-bottom: 5px;
    display: block;
}

h1, h2, h3, h4, h5, h6 {
    color: #151d31;
    margin-bottom: 15px;
    font-weight: 700;
}

h1 {
    font-size: 32px;
}

h2 {
    font-size: 28px;
}

h3 {
    font-size: 24px;
}

/* Form Group and Input Layout */
.form-group {
    margin-bottom: 20px;
}

.form-group .form-control {
    border-radius: 8px;
}

/* Checkbox and Radio Styling */
.form-check-input {
    accent-color: #007bff;
    cursor: pointer;
}

.form-check-label {
    font-weight: 500;
    color: #333;
    margin-left: 8px;
}

/* Full Width Form Fields on Small Screens */
@media (max-width: 576px) {
    .form-group {
        flex-direction: column;
        width: 100%;
    }

    .form-group .form-control,
    .form-group .form-select {
        width: 100%;
        box-sizing: border-box;
    }


    .d-flex {
        flex-direction: column;
        width: 100%;
    }

    .d-flex .form-control,
    .d-flex .form-select {
        width: 100%;
        box-sizing: border-box;
    }
}

/* Override Bootstrap Width for Small Screens */
@media (max-width: 576px) {
    .w-50 {
        width: 100% !important;
    }
}
    .map-container {
        width: 100%;
        height: 400px;
        margin-top: 5px;
        margin-bottom: 15px;
        border-radius: 10px;
        display: none; /* Initially hidden */
    }

    /* Flex container for Meeting Room and Private Cabin inputs */
.d-flex {
    display: flex !important;
    gap: 15px;
    align-items: center;
}

.d-flex .form-control {
    flex: 1;
}


/* Flex container for Meeting Room and Private Cabin inputs */
.room-details {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: center;
}

.wrap{
    flex-wrap: wrap;
}

@media screen and (max-width: 576px) {
    .wrap{
        flex-direction: column;
    }
    .d-flex {
        flex-direction: column;
    }
    .room-details
    {
        flex-direction: column;
    }
}

.room-details .form-control {
    flex: 1;
    width: 100%;
    box-sizing: border-box;
}

.room-details .form-select {
    flex: 1;
    width: 100%;
    box-sizing: border-box;
}

/* Two columns on larger screens, full width on smaller screens */
@media (max-width: 576px) {
    .form-group.d-flex {
        display: flex;
        flex-wrap: wrap !important;
        gap: 15px;
        align-items: center;
    }

    .form-group.d-flex .form-control,
    .form-group.d-flex .form-select {
        flex: 1;
        width: 100%;
    }
}

/* Full Width on Smaller Screens */
@media (max-width: 576px) {
    .form-group.d-flex {
        flex-direction: column;
    }

    .form-group.d-flex .form-control,
    .form-group.d-flex .form-select {
        width: 100%;
    }
}

/* Adjust layout for new input fields */
#space_details_${spaceCount} ul {
    list-style-type: disc;
    margin-left: 20px;
    color: #555;
}
#space_details_${spaceCount} h6 {
    font-weight: bold;
    color: #333;
}

    </style>

    <!-- Facebook Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window,document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '3647529905577467'); 
        fbq('track', 'PageView');
        </script>
        <noscript>
        <img height="1" width="1" 
        src="https://www.facebook.com/tr?id=3647529905577467&ev=PageView
        &noscript=1"/>
        </noscript>
    <!-- End Facebook Pixel Code -->

    <!-- Google Tag Manager -->
<script>

(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MX8P4NN6');

</script>
<!-- End Google Tag Manager -->

<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window,document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
 fbq('init', '3647529905577467'); 
fbq('track', 'PageView');
</script>
<noscript>
 <img height="1" width="1" 
src="https://www.facebook.com/tr?id=3647529905577467&ev=PageView
&noscript=1"/>
</noscript>
<!-- End Facebook Pixel Code -->
</head>
<body>

<div class="container">

    <!-- Flash Messages (Success/Error) -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mb-4">
            {% for category, message in messages %}
              <div class="flash-message flash-{{ 'success' if category == 'success' else 'error' }}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
    {% endwith %}

    <h1 class="text-center mb-4 head">{{ 'Edit Your Space' if space else 'List Your Space' }}</h1>
            <!-- "Where did you hear from us?" Section -->
            <div class="card">
                <div class="card-header">
                    General Information
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <div class="w-100">
                            <label for="hear_from" class="form-label">Where did you hear from us?</label>
                            <select class="form-select" id="hear_from" name="hear_from" required
                                data-parsley-required-message="Please select an option." data-parsley-trigger="change" aria-label="Where did you hear from us?">
                                <option value="" disabled selected>Select an option</option>
                                <option value="Email campaigns">Email campaigns</option>
                                <option value="WhatsApp campaigns">WhatsApp campaigns</option>
                                <option value="Facebook">Facebook</option>
                                <option value="Instagram">Instagram</option>
                                <option value="Calls">Calls</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="w-100">
                            <label for="workspace_tool" class="form-label">Which Workspace Management Tool are you using?</label>
                            <select class="form-select" id="workspace_tool" name="workspace_tool" required
                                data-parsley-required-message="Please select an option." data-parsley-trigger="change" aria-label="Workspace Management Tool">
                                <option value="" disabled selected>Select a tool</option>
                                <option value="Briskly">Briskly</option>
                                <option value="Cobot">Cobot</option>
                                <option value="Coworkify">Coworkify</option>
                                <option value="Digicuro">Digicuro</option>
                                <option value="Engage">Engage</option>
                                <option value="Nexudus">Nexudus</option>
                                <option value="Optix">Optix</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <!-- Custom Input Field for 'Other' Selection -->
                    <div class="form-group" id="workspace_tool_other_container" style="display: none;">
                        <label for="workspace_tool_other" class="form-label">Please specify:</label>
                        <input type="text" class="form-control" id="workspace_tool_other" name="workspace_tool_other"
                            placeholder="Enter tool name" data-parsley-required-message="Please specify the tool name." 
                            data-parsley-trigger="change">
                    </div>
                    <div class="form-group">
                        <div class="w-100">
                            <label for="notification" class="form-label">Where shall we send notifications?</label>
                            <select class="form-select" id="notification" name="notification_preference" multiple required
                                data-parsley-required-message="Please select the platform where we can connect."
                                data-parsley-trigger="change" aria-label="Notification Preference">
                                <option value="Whatsapp">WhatsApp</option>
                                <option value="Dashboard">Dashboard</option>
                                <option value="Email">Email</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

    <!-- Form: Owner Information and Coworking Space Details -->
    <form id="listSpaceForm" action="{{ url_for('core_bp.list_your_space') if not space else url_for('operators.edit_space', space_id=space['_id']) }}" method="post" enctype="multipart/form-data" data-parsley-validate>
        {% if context != 'add_space' %}
            {% if role == 'center_manager' %}
            <div class="card">
                <div class="card-header">
                    Stage 1: Owner Information
                </div>
                <div class="card-body">
                    <div class="form-group mb-3">
                        <div class="mb-3 w-100">
                            <input type="text" class="form-control" id="name" name="name" placeholder="Your Name" required
                                value="{{ space['owner']['name'] if space else '' }}"
                                readonly>
                        </div>
                        <div class="mb-3 w-100">
                            <input type="tel" class="form-control" id="owner_phone" name="owner_phone" placeholder="Owner Phone Number" required
                                value="{{ space['owner']['phone'] if space else '' }}"
                                readonly>
                        </div>
                    </div>
                    <div class="form-group mb-3">
                        <div class="mb-3 w-100">
                            <input type="email" class="form-control" id="owner_email" name="owner_email" placeholder="Owner Email Address" required
                            value="{{ space['owner']['email'] if space else '' }}"
                            readonly>
                        </div>
                        <div class="mb-3 w-100">
                            <input type="text" class="form-control" id="coworking_name" name="coworking_name" placeholder="Coworking Name" required
                                value="{{ space['coworking_name'] if space else '' }}"
                                readonly>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="card">
                <div class="card-header">
                    Stage 1: Owner Information
                </div>
                <div class="card-body">
                    <div class="form-group mb-3">
                        <div class="mb-3 w-100">
                            <input type="text" class="form-control" id="coworking_name" name="coworking_name" placeholder="Coworking Name" required
                                value="{{ space['coworking_name'] if space else '' }}"
                                data-parsley-required-message="Please enter the coworking space name." data-parsley-trigger="change" aria-label="Coworking Name">
                        </div>
                        <div class="mb-3 w-100">
                            <input type="text" class="form-control" id="name" name="name" placeholder="Your Name" required
                                value="{{ space['owner']['name'] if space else '' }}"
                                data-parsley-required-message="Please enter your name." data-parsley-trigger="change" aria-label="Your Name">
                        </div>
                    </div>
                    <div class="form-group mb-3">
                        <div class="mb-3 w-100">
                            <input type="tel" class="form-control" id="owner_phone" name="owner_phone" placeholder="Owner Phone Number" required
                                value="{{ space['owner']['phone'] if space else '' }}"
                                data-parsley-required-message="Please enter your phone number."
                                data-parsley-pattern="^[0-9]{10}$"
                                data-parsley-pattern-message="Please enter a valid 10-digit phone number."
                                data-parsley-trigger="change" aria-label="Owner Phone Number">
                        </div>
                        <div class="mb-3 w-100">
                            <input type="email" class="form-control" id="owner_email" name="owner_email" placeholder="Owner Email Address" required
                                value="{{ space['owner']['email'] if space else '' }}"
                                data-parsley-required-message="Please enter your email address."
                                data-parsley-type="email"
                                data-parsley-type-message="Please enter a valid email address."
                                data-parsley-trigger="change" aria-label="Owner Email Address">
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        {% else %}
        <!-- Hidden Owner Information for Add Space -->
        <input type="hidden" name="name" value="{{ owner_details['name'] }}">
        <input type="hidden" name="owner_phone" value="{{ owner_details['phone'] }}">
        <input type="hidden" name="owner_email" value="{{ owner_details['email'] }}">
        <div class="mb-3 w-100">
            <input type="text" class="form-control" id="coworking_name" name="coworking_name" placeholder="Coworking Name" readonly
                value="{{ coworking_name }}"
                aria-label="Coworking Name">
        </div>
        {% endif %}

        <!-- Stage 2: Coworking Space Details -->
        <div id="spaceDetailsContainer">
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    {% if space %}
                        // Edit mode: Pre-fill with existing data
                        addSpaceDetails({{ space | tojson | safe }});
                    {% else %}
                        // Add/Normal mode: Initialize with one empty section
                        addSpaceDetails();
                    {% endif %}
                });
            </script>
        </div>

        <!-- Button to add more coworking spaces (Hide when editing) -->
        {% if not space %}
        <button type="button" class="btn btn-primary mb-3 add-space-button" onclick="addSpaceDetails()">+ Add Coworking Space</button>
        {% endif %}

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center my-3">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p>Submitting your information...</p>
        </div>
        
        <button type="submit" class="btn centered-button submit-btn" id="submitButton">{{ 'Update Space' if space else 'Submit for Approval' }}</button>

    </form>
</div>


<!-- jQuery (Required for Parsley.js if using older versions; optional for newer setups) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Parsley JS -->
<script src="https://cdn.jsdelivr.net/npm/parsleyjs"></script>

<!-- Bootstrap JS (for components like modals, if needed) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript to handle dynamic form sections and Parsley validation -->
<script>
    let spaceCount = 0;
    
    function toggleWorkspaceTypeFields(spaceId) {
    const workspaceTypeDropdown = document.getElementById(`workspace_type_${spaceId}`);
    const coworkingFields = document.getElementById(`coworking_fields_${spaceId}`);
    const managedOfficeFields = document.getElementById(`managed_office_fields_${spaceId}`);
    const amenitiesSection = document.getElementById(`amenities_section_${spaceId}`);
    const officeTimingsSection = document.getElementById(`office_timings_${spaceId}`);

    if (workspaceTypeDropdown.value === "Coworking Spaces") {
        coworkingFields.style.display = "block";
        managedOfficeFields.style.display = "none";
        amenitiesSection.style.display = "block";
        officeTimingsSection.style.display = "block"; // ✅ Fix: Show Office Timings section
    } else {
        coworkingFields.style.display = "none";
        managedOfficeFields.style.display = "block";
        amenitiesSection.style.display = "none";
        officeTimingsSection.style.display = "none"; // ✅ Fix: Hide Office Timings section
    }
}
    
// Function to update space details based on the type of space selected
function updateSpaceDetails(spaceCount) {
    const spaceType = document.getElementById(`space_type_${spaceCount}`).value;
    const detailsContainer = document.getElementById(`space_details_${spaceCount}`);

    let detailsHTML = '';

    switch (spaceType) {
        case 'economy':
            detailsHTML = `
                <h6>Economy</h6>
                <ul>
                    <li>Work desk size: 3×2 ft.</li>
                    <li>Billable area: ~35 sq.ft.</li>
                </ul>
            `;
            break;
        case 'average':
            detailsHTML = `
                <h6>Average</h6>
                <ul>
                    <li>Work desk size: 3.5×2 ft.</li>
                    <li>Billable area: ~50 sq.ft.</li>
                </ul>
            `;
            break;
        case 'spacious':
            detailsHTML = `
                <h6>Spacious</h6>
                <ul>
                    <li>Work desk size: 4×2 ft.</li>
                    <li>Billable area: ~60 sq.ft.</li>
                </ul>
            `;
            break;
        default:
            detailsHTML = '';
    }

    detailsContainer.innerHTML = detailsHTML;
}

    // Function to toggle Managed Offices fields based on workspace type selection
    // Function to toggle fields based on workspace type selection
    // Function to toggle fields based on workspace type selectio

    // Function to add a coworking space section
    function addSpaceDetails(spaceData = null) {
            // Prevent multiple sections in edit mode
        if (spaceData && spaceCount > 0) {
            return;
        }
        spaceCount++;

        const spaceDetailsContainer = document.getElementById('spaceDetailsContainer');

        const spaceCard = document.createElement('div');
        spaceCard.classList.add('card');

        // Pre-fill values if spaceData is provided
        const city = spaceData ? spaceData['city'] || '' : '';
        const micromarket = spaceData ? spaceData['micromarket'] || '' : '';
        const total_seats = spaceData ? spaceData['total_seats'] || '' : '';
        const current_vacancy = spaceData ? spaceData['current_vacancy'] || '' : '';
        const center_manager_name = spaceData ? spaceData['center_manager_name'] || '' : '';
        const center_manager_contact = spaceData ? spaceData['center_manager_contact'] || '' : '';

        const inventoryList = spaceData ? spaceData['inventory'] || [] : [];

        spaceCard.innerHTML = `
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Stage 2: Coworking Space Details (${spaceCount})</span>
                ${spaceData ? '' : '<button type="button" class="delete-button" onclick="removeSpaceDetails(this)" title="Remove this coworking space">&times;</button>'}
            </div>
            <div class="card-body">
                <!-- Hidden input to keep track of space indices -->
                <input type="hidden" name="space_indices[]" value="${spaceCount}">

                <!-- City and Micromarket -->
                <div class="form-group">
                    <div class=" w-100">
                        <select id="location_${spaceCount}" class="form-control" name="city[]" placeholder="City" value="${city}"
                        data-parsley-required-message="Please enter the city." data-parsley-trigger="change" aria-label="City" required onchange="fetchMicromarkets()">
                            <option value="" disabled ${city ? '' : 'selected'}>Select Location *</option>
                        </select>
                    </div>
                    <div class=" w-100">
                        <select id="micromarket_${spaceCount}" class="form-control" name="micromarket[]" placeholder="Micromarket" required
                            value="${micromarket}"
                            data-parsley-required-message="Please enter the micromarket." data-parsley-trigger="change" aria-label="Micromarket>
                            <option value="" disabled ${micromarket ? '' : 'selected'}>Select Micromarket *</option>
                        </select>
                    </div>
                </div>
                <!-- Add Full Address Field Below -->
                <div class="form-group mb-3 position-relative">
                    <div class="mb-3 w-100">
                        <label for="address_${spaceCount}" class="form-label">Coworking Address *</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="address_${spaceCount}" name="address[]" placeholder="Enter Your Address Manually..." required
                                data-parsley-required-message="Please enter the coworking address." data-parsley-trigger="change" aria-label="Full Address">
                            <button type="button" class="btn current-location-btn" onclick="getCurrentLocation(${spaceCount})">
                                <span class="pin-icon">📍</span> Use Current Location
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Distance Fields -->
<h5 class="mt-3">Distance From Major Transport Hubs</h5>
<div class="form-group mb-3 d-flex flex-row gap-3">
    <!-- Distance from Metro -->
    <div class="w-50">
        <label for="distance_metro_${spaceCount}" class="form-label">Distance from Nearest Metro (km) *</label>
        <input type="number" class="form-control" id="distance_metro_${spaceCount}" name="distance_metro[]" placeholder="Enter distance in km" min="0" required
            data-parsley-required-message="Please enter the distance from the nearest metro station."
            data-parsley-type="number" step="0.1" data-parsley-trigger="change">
    </div>

    <!-- Distance from Airport -->
    <div class="w-50">
        <label for="distance_airport_${spaceCount}" class="form-label">Distance from Nearest Airport (km) *</label>
        <input type="number" class="form-control" id="distance_airport_${spaceCount}" name="distance_airport[]" placeholder="Enter distance in km" min="0" required
            data-parsley-required-message="Please enter the distance from the nearest airport."
            data-parsley-type="number" step="0.1" data-parsley-trigger="change">
    </div>
</div>

<div class="form-group mb-3 flex flex-row gap-3 ">
    <!-- Distance from Bus Station -->
    <div class="w-50">
        <label for="distance_bus_${spaceCount}" class="form-label">Distance from Nearest Bus Station (km) *</label>
        <input type="number" class="form-control" id="distance_bus_${spaceCount}" name="distance_bus[]" placeholder="Enter distance in km" min="0" required
            data-parsley-required-message="Please enter the distance from the nearest bus station."
            data-parsley-type="number" step="0.1" data-parsley-trigger="change">
    </div>

    <!-- Distance from Railway Station -->
    <div class="w-50">
        <label for="distance_railway_${spaceCount}" class="form-label">Distance from Nearest Railway Station (km) *</label>
        <input type="number" class="form-control" id="distance_railway_${spaceCount}" name="distance_railway[]" placeholder="Enter distance in km" min="0" required
            data-parsley-required-message="Please enter the distance from the nearest railway station."
            data-parsley-type="number" step="0.1" data-parsley-trigger="change">
    </div>
</div>

                <!-- Map Container -->
                <div id="map_${spaceCount}" class="map-container"></div>

                <!-- Upload Layout or Property Images (Moved Below Address) -->
                <!-- Upload Property Images (Min 5) -->
                <h5>Upload Images of Your Property (Min 5)</h5>
                <p class="file-format-note">Upload at least 5 images of your property (JPG, JPEG, PNG).</p>
                <div class="mb-3">
                    <input type="file" class="form-control" name="property_images_${spaceCount}[]" accept="image/png, image/jpeg, image/jpg" multiple
                        required data-parsley-mincheck="5"
                        data-parsley-required-message="Please upload at least 5 images of your property."
                        onchange="previewPropertyImages(event, ${spaceCount})">
                </div>
                <div id="propertyImagePreview_${spaceCount}" class="d-flex flex-wrap"></div>
                <!-- End of Property Images Upload -->
                <!-- Center Manager Details -->
                <h5 class="team">Who is in your Team?</h5>
                <div class="form-group mb-3">
                    <div class="mb-3 w-100">
                        <input type="text" class="form-control" name="center_manager_name[]" placeholder="Who manages this workspace?" required
                            value="${center_manager_name}"
                            data-parsley-required-message="Please enter the center manager name."
                            data-parsley-trigger="change" aria-label="Center Manager Name">
                    </div>
                    <div class="mb-3 w-100">
                        <input type="tel" class="form-control" name="center_manager_contact[]" placeholder="Contact number" required
                            value="${center_manager_contact}"
                            data-parsley-required-message="Please enter the center manager contact."
                            data-parsley-pattern="^[0-9]{10}$"
                            data-parsley-pattern-message="Please enter a valid 10-digit phone number."
                            data-parsley-trigger="change" aria-label="Center Manager Contact">
                    </div>
                </div>
                <!-- About Space -->
                <h5>About Space</h5>
                <!-- Choose Workspace Type -->
                <div class="form-group mb-3">
                    <div class="mb-3 w-100">
                        <label for="workspace_type_${spaceCount}" class="form-label">Choose Workspace Type *</label>
                        <select class="form-select" id="workspace_type_${spaceCount}" name="workspace_type[]" required
                            data-parsley-required-message="Please select the workspace type."
                            data-parsley-trigger="change" aria-label="Choose Workspace Type"
                            onchange="toggleWorkspaceTypeFields(${spaceCount})">
                            <option value="" disabled selected>Choose Workspace Type</option>
                            <option value="Coworking Spaces">Coworking Spaces</option>
                            <option value="Managed Offices">Managed Offices</option>
                        </select>
                    </div>
                </div>

                <!-- Coworking Space Fields (Hidden by Default) -->
                <div id="coworking_fields_${spaceCount}" style="display: none;">
                    <div class="form-group mb-3">
                        <div class="mb-3 w-100">
                            <input type="number" class="form-control" name="total_seats[]" placeholder="Total Seats" min="0" required
                                data-parsley-required-message="Please enter the total number of seats."
                                data-parsley-type="number" data-parsley-trigger="change"
                                aria-label="Total Seats" onchange="updateCurrentVacancy(${spaceCount})">
                        </div>
                        <div class="mb-3 w-100" id="current_vacancy_container_${spaceCount}" style="display: none;">
                            <input type="number" class="form-control" name="current_vacancy[]" placeholder="This value is automatically calculated" min="0" readonly
                                value="0" id="current_vacancy_${spaceCount}" aria-label="Current Vacancy">
                            <small class="text-muted">This value will be automatically calculated based on the inventory.</small>
                            <div id="vacancyError_${spaceCount}" class="text-danger mt-1"></div>
                        </div>
                    </div>

                    <!-- Inventory Breakup -->
                    <h5>Inventory Breakup</h5>
                    <div id="inventoryContainer_${spaceCount}">
                        <!-- Inventory items will be added here -->
                    </div>
                    <button type="button" class="btn btn-secondary mb-3" onclick="addInventory(${spaceCount})">+ Add Inventory</button>

                    <!-- Amenities Section (Visible only for Coworking Spaces) -->
                    <h5 class="amen">Amenities</h5>
                    <div id="amenities_section_${spaceCount}" class="mb-3" style="display: none;">
                        <p class="file-format-note">Select Amenities Available in your Space.</p>
                        <div class="rowamen">
                            <!-- Amenities Checkboxes (3 per row) -->
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Air Conditioning" id="air_conditioning_${spaceCount}"
                                required data-parsley-mincheck="1" 
                                data-parsley-required-message="Please select at least one amenity.">
                                <label for="air_conditioning_${spaceCount}" class="form-check-label">
                                    Air Conditioning<span class="amenity-icon">🌬️</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Car / Bike Parking" id="parking_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="parking_${spaceCount}" class="form-check-label">
                                    Car / Bike Parking<span class="amenity-icon">🚗</span>
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Ergo Workstations" id="ergo_workstations_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="ergo_workstations_${spaceCount}" class="form-check-label">
                                    Ergo Workstations<span class="amenity-icon">🪑</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="High Speed WiFi" id="wifi_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="wifi_${spaceCount}" class="form-check-label">
                                    High Speed WiFi<span class="amenity-icon">📶</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Housekeeping" id="housekeeping_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="housekeeping_${spaceCount}" class="form-check-label">
                                    Housekeeping<span class="amenity-icon">🧹</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Lounge" id="lounge_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="lounge_${spaceCount}" class="form-check-label">
                                    Lounge<span class="amenity-icon">🍹</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Meeting Rooms" id="meeting_rooms_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="meeting_rooms_${spaceCount}" class="form-check-label">
                                    Meeting Rooms<span class="amenity-icon">🪑</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Pantry" id="pantry_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="pantry_${spaceCount}" class="form-check-label">
                                    Pantry<span class="amenity-icon">🥤</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Phone Booth" id="phone_booth_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="phone_booth_${spaceCount}" class="form-check-label">
                                    Phone Booth<span class="amenity-icon">📞</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Printer" id="printer_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="printer_${spaceCount}" class="form-check-label">
                                    Printer<span class="amenity-icon">🖨️</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Reception" id="reception_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="reception_${spaceCount}" class="form-check-label">
                                    Reception<span class="amenity-icon">👥</span> 
                                </label>
                            </div>
                            <div class="col-md-4-amen">
                                <input type="checkbox" class="form-check-input" name="amenities_${spaceCount}[]" value="Tea/Coffee" id="tea_coffee_${spaceCount}" required data-parsley-mincheck="1" 
                data-parsley-required-message="Please select at least one amenity.">
                                <label for="tea_coffee_${spaceCount}" class="form-check-label">
                                    Tea/Coffee<span class="amenity-icon">☕</span> 
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Office Timings Section -->
                    <div id="office_timings_${spaceCount}" class="mb-3" style="display: none;">
                        <h5 class="off">Office Timings</h5>
                        
                        <!-- Open From and Open To -->
                        <div class="form-group mb-3">
                            <div class="w-50">
                                <label for="open_from_${spaceCount}" class="form-label">Open From *</label>
                                <select class="form-select" id="open_from_${spaceCount}" name="open_from_${spaceCount}" required
                                    data-parsley-required-message="Please select the opening day."
                                    data-parsley-trigger="change">
                                    <option value="" disabled selected>Select a day</option>
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                    <option value="Sunday">Sunday</option>
                                </select>
                            </div>
                            <div class="w-50">
                                <label for="open_to_${spaceCount}" class="form-label">Open To *</label>
                                <select class="form-select" id="open_to_${spaceCount}" name="open_to_${spaceCount}" required
                                    data-parsley-required-message="Please select the closing day."
                                    data-parsley-trigger="change">
                                    <option value="" disabled selected>Select a day</option>
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                    <option value="Sunday">Sunday</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Opening Timings -->
                        <h5 class="hour">Opening Hours</h5>
                        <div class="form-group mb-3">
                            <div class="w-50">
                                <label for="opening_time_${spaceCount}" class="form-label">Opening Time *</label>
                                <input type="time" class="form-control" id="opening_time_${spaceCount}" name="opening_time_${spaceCount}" required
                                    data-parsley-required-message="Please enter the opening time." data-parsley-trigger="change">
                            </div>
                            <div class="w-50">
                                <label for="closing_time_${spaceCount}" class="form-label">Closing Time *</label>
                                <input type="time" class="form-control" id="closing_time_${spaceCount}" name="closing_time_${spaceCount}" required
                                    data-parsley-required-message="Please enter the closing time." data-parsley-trigger="change">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Managed Office Fields (Hidden by Default) -->
                <div id="managed_office_fields_${spaceCount}" style="display: none;">
                    <h5>Managed Office Details</h5>

                    <!-- First Row: Rent or Own & Total Building Area -->
                    <!-- Rent or Own & Total Building Area -->
                    <div class="form-group mb-3 d-flex gap-3 " id="no"> 
                        <div class="w-50">
                            <label for="rent_or_own_${spaceCount}" class="form-label">Do you rent or own your space?</label>
                            <select class="form-select" id="rent_or_own_${spaceCount}" name="rent_or_own_${spaceCount}" required
                                data-parsley-required-message="Please select an option."
                                data-parsley-trigger="change">
                                <option value="" disabled selected>Select an option</option>
                                <option value="Rent">Rent</option>
                                <option value="Own">Own</option>
                            </select>
                        </div>

                        <div class="w-50">
                            <label for="total_building_area_${spaceCount}" class="form-label"> Building Area in Carpet Area (sqft)</label>
                            <input type="number" onchange="calculateMinInventoryUnit(${spaceCount})" class="form-control" id="total_building_area_${spaceCount}" name="total_building_area_${spaceCount}" 
                                placeholder="Enter total building area" min="0" required
                                data-parsley-required-message="Please enter the total building area."
                                data-parsley-type="digits" data-parsley-trigger="change focusout">
                        </div>
                    </div>

                    <!-- Floorplate Area & Min Inventory Unit -->
                    <div class="form-group mb-3 d-flex gap-3" id="no">
                        <div class="w-50">
                            <label for="floorplate_area_${spaceCount}" class="form-label">Floorplate Area in Carpet Area (sqft)</label>
                            <input type="number" class="form-control" id="floorplate_area_${spaceCount}" name="floorplate_area_${spaceCount}" 
                                placeholder="Enter floorplate area" min="0" required
                                data-parsley-required-message="Please enter the floorplate area."
                                data-parsley-type="digits" data-parsley-trigger="change focusout">
                        </div>

                        <div class="w-50">
                            <label for="total_rental_${spaceCount}" class="form-label">Total Rental Expectation</label>
                            <input type="number" class="form-control" id="total_rental_${spaceCount}" name="total_rental_${spaceCount}" 
                                placeholder="Enter total rental expectation" min="0" required
                                data-parsley-required-message="Please enter the total rental expectation."
                                data-parsley-type="digits" data-parsley-trigger="change focusout">
                        </div>
                    </div>

                    <!-- Security Deposit & Lease Term -->
    <div class="form-group mb-3 d-flex gap-3">
        <div class="w-50">
            <label for="security_deposit_${spaceCount}" class="form-label">Security Deposit (in INR)</label>
            <input type="number" class="form-control" id="security_deposit_${spaceCount}" name="security_deposit_${spaceCount}" 
                placeholder="Enter security deposit amount" min="0" required
                data-parsley-required-message="Please enter the security deposit amount."
                data-parsley-type="digits" data-parsley-trigger="change focusout">
        </div>

        <div class="w-50">
            <label for="lease_term_${spaceCount}" class="form-label">Lease Term</label>
            <select class="form-select" id="lease_term_${spaceCount}" name="lease_term_${spaceCount}" required
                data-parsley-required-message="Please select the lease term."
                data-parsley-trigger="change">
                <option value="" disabled selected>Select Lease Term</option>
                ${[...Array(8).keys()].map(i => `<option value="${(i+1) * 11}">${(i+1) * 11} months</option>`).join('')}
            </select>
        </div>
    </div>

                    <!-- Number of Floors & Occupied Floors -->
                    <div class="form-group mb-3 d-flex gap-3" id="no">
                        <div class="w-50">
                            <label for="total_floors_${spaceCount}" class="form-label">Number of Floors</label>
                            <input type="number" class="form-control" id="total_floors_${spaceCount}" name="total_floors_${spaceCount}"
                                placeholder="Enter total number of floors" min="0" required
                                onchange="generateOfferedFloorsChecklist(${spaceCount})"
                                data-parsley-required-message="Please enter the number of floors."
                                data-parsley-type="digits" data-parsley-trigger="change focusout">
                            <div id="offered_floors_container_${spaceCount}" class="mt-2"></div>
                        </div>

                        <div class="w-50">
                            <label for="floors_occupied_${spaceCount}" class="form-label">Number of Floors Occupied</label>
                            <input type="number" class="form-control" id="floors_occupied_${spaceCount}" name="floors_occupied_${spaceCount}"
                                placeholder="Enter number of occupied floors" min="0" required
                                data-parsley-required-message="Please enter the number of floors occupied."
                                data-parsley-type="digits" data-parsley-trigger="change focusout">
                        </div>
                    </div>

                    <!-- Seating Capacity & Furnishing Level -->
                    <div class="form-group mb-3 d-flex gap-3" id="no">
                        <div class="w-50">
                            <label for="furnishing_level_${spaceCount}" class="form-label">Furnishing Level</label>
                            <select class="form-select" id="furnishing_level_${spaceCount}" name="furnishing_level_${spaceCount}" required
                                data-parsley-required-message="Please select the furnishing level."
                                data-parsley-trigger="change">
                                <option value="" disabled selected>Select Furnishing Level</option>
                                <option value="Bare shell">Bare shell</option>
                                <option value="Warm shell">Warm shell</option>
                                <option value="Ready to move in">Ready to move in</option>
                            </select>
                        </div>
                        <div class="w-50">
                        <label for="lockin_period_${spaceCount}" class="form-label">Expected Lock-in Period (Months)</label>
                        <select class="form-select" id="lockin_period_${spaceCount}" name="lockin_period_${spaceCount}" required
                            data-parsley-required-message="Please select the lock-in period."
                            data-parsley-trigger="change">
                            <option  selected>No Lock-in Period</option>
                                    <option value="3 months">3 months</option>
                                    <option value="6 months">6 months</option>
                                    <option value="1 year">1 year</option>
                                    <option value="2 years">2 years</option>
                                    <option value="3 years">3 years</option>
                                    <option value="4 years">4 years</option>
                                    <option value="5 years">5 years</option>
                        </select>
                        </div>
                    </div>


                    <!-- Type of Space Dropdown -->
                    <div class="form-group mb-3">
                        <div class="w-100">
                            <label for="space_type_${spaceCount}" class="form-label">Type of Space</label>
                            <select class="form-select" onchange="updateSpaceDetails(${spaceCount}); calculateMinInventoryUnit(${spaceCount})" id="space_type_${spaceCount}" name="space_type_${spaceCount}" required
                                data-parsley-required-message="Please select the type of space."
                                data-parsley-trigger="change" onchange="updateSpaceDetails(${spaceCount})">
                                <option value="" disabled selected>Select Type of Space</option>
                                <option value="economy">Economy</option>
                                <option value="average">Average</option>
                                <option value="spacious">Spacious</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dynamic Details for Type of Space -->
                    <div class="form-group mb-3" id="space_details_${spaceCount}">
                        <!-- This section will be dynamically updated with JS -->
                    </div>

                    <div id="min_inventory_unit_wrapper_${spaceCount}" style="display: none;">
    <label for="min_inventory_unit_${spaceCount}" class="form-label">Min Inventory Unit</label>
    <input type="hidden" id="min_inventory_unit_${spaceCount}" name="min_inventory_unit_${spaceCount}">
</div>
                    <!-- Managed Office Amenities -->
<h5 class="amen">Managed Office Amenities</h5>
<div id="managed_amenities_section_${spaceCount}" class="mb-3">
    <p class="file-format-note">Select Amenities Available in your Managed Office.</p>
    <div class="rowamen">
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Conference Room" id="conference_room_${spaceCount}">
            <label for="conference_room_${spaceCount}" class="form-check-label">Conference Room</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Meeting Room" id="meeting_room_${spaceCount}">
            <label for="meeting_room_${spaceCount}" class="form-check-label">Meeting Room</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Private Cabins" id="private_cabins_${spaceCount}">
            <label for="private_cabins_${spaceCount}" class="form-check-label">Private Cabins</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Hot Desks" id="hot_desks_${spaceCount}">
            <label for="hot_desks_${spaceCount}" class="form-check-label">Hot Desks</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Lounge Area" id="lounge_${spaceCount}">
            <label for="lounge_${spaceCount}" class="form-check-label">Lounge Area</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Reception Area" id="reception_${spaceCount}">
            <label for="reception_${spaceCount}" class="form-check-label">Reception Area</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="High-Speed WiFi" id="wifi_${spaceCount}">
            <label for="wifi_${spaceCount}" class="form-check-label">High-Speed WiFi</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="24x7 Security" id="security_${spaceCount}">
            <label for="security_${spaceCount}" class="form-check-label">24x7 Security</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="CCTV Surveillance" id="cctv_${spaceCount}">
            <label for="cctv_${spaceCount}" class="form-check-label">CCTV Surveillance</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Car / Bike Parking" id="parking_${spaceCount}">
            <label for="parking_${spaceCount}" class="form-check-label">Car / Bike Parking</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Air Conditioning" id="air_conditioning_${spaceCount}">
            <label for="air_conditioning_${spaceCount}" class="form-check-label">Air Conditioning</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Housekeeping" id="housekeeping_${spaceCount}">
            <label for="housekeeping_${spaceCount}" class="form-check-label">Housekeeping</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Printing / Scanning" id="printing_${spaceCount}">
            <label for="printing_${spaceCount}" class="form-check-label">Printing / Scanning</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Power Backup" id="power_backup_${spaceCount}">
            <label for="power_backup_${spaceCount}" class="form-check-label">Power Backup</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Pantry" id="pantry_${spaceCount}">
            <label for="pantry_${spaceCount}" class="form-check-label">Pantry</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Tea / Coffee" id="tea_coffee_${spaceCount}">
            <label for="tea_coffee_${spaceCount}" class="form-check-label">Tea / Coffee</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Vending Machine" id="vending_machine_${spaceCount}">
            <label for="vending_machine_${spaceCount}" class="form-check-label">Vending Machine</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Locker Storage" id="locker_${spaceCount}">
            <label for="locker_${spaceCount}" class="form-check-label">Locker Storage</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Smoking Zone" id="smoking_zone_${spaceCount}">
            <label for="smoking_zone_${spaceCount}" class="form-check-label">Smoking Zone</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Recreation Area" id="recreation_area_${spaceCount}">
            <label for="recreation_area_${spaceCount}" class="form-check-label">Recreation Area</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Gym & Fitness" id="gym_${spaceCount}">
            <label for="gym_${spaceCount}" class="form-check-label">Gym & Fitness</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Event Space" id="event_space_${spaceCount}">
            <label for="event_space_${spaceCount}" class="form-check-label">Event Space</label>
        </div>
        
        <!-- New amenities below -->
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Lift" id="lift_${spaceCount}">
            <label for="lift_${spaceCount}" class="form-check-label">Lift</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Fire Exit" id="fire_exit_${spaceCount}">
            <label for="fire_exit_${spaceCount}" class="form-check-label">Fire Exit</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Washroom" id="washroom_${spaceCount}">
            <label for="washroom_${spaceCount}" class="form-check-label">Washroom</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Occupancy Certificate" id="occupancy_certificate_${spaceCount}">
            <label for="occupancy_certificate_${spaceCount}" class="form-check-label">Occupancy Certificate</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Fire NOC" id="fire_noc_${spaceCount}">
            <label for="fire_noc_${spaceCount}" class="form-check-label">Fire NOC</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Lift NOC" id="lift_noc_${spaceCount}">
            <label for="lift_noc_${spaceCount}" class="form-check-label">Lift NOC</label>
        </div>
        <div class="col-md-4-amen">
            <input type="checkbox" class="form-check-input" name="managed_amenities_${spaceCount}[]" value="Completion Certificate" id="completion_certificate_${spaceCount}">
            <label for="completion_certificate_${spaceCount}" class="form-check-label">Completion Certificate</label>
        </div>
    </div>
</div>
                </div>


                <!-- Common Section: Tell Us About Your Space -->
                <h5 class="tell">Tell us about your space and why it's so great</h5>
                <div class="form-group mb-3">
                    <textarea class="form-control" name="space_description_${spaceCount}" rows="4"
                        placeholder="Describe your workspace, amenities, and why it's a great place to work" required
                        data-parsley-required-message="Please describe your workspace."
                        data-parsley-trigger="change" required></textarea>
                </div>
            </div>
        `;
        spaceDetailsContainer.appendChild(spaceCard);
        // Populate the location dropdown
        populateLocationsDropdown(spaceCount, city, micromarket);

        // Initialize the inventory section
        if (inventoryList.length > 0) {
            inventoryList.forEach((inventoryItem) => {
                addInventory(spaceCount, inventoryItem);
            });
        } else {
            addInventory(spaceCount);
        }


        // Display existing images if any
        if (spaceData && spaceData['layout_images'] && spaceData['layout_images'].length > 0) {
            const imagePreviewContainer = document.getElementById(`imagePreview_${spaceCount}`);
            spaceData['layout_images'].forEach((imageUrl, index) => {
                const imgContainer = document.createElement('div');
                imgContainer.classList.add('preview-img-container');
                imgContainer.innerHTML = `
                    <img src="${imageUrl}" class="preview-img" data-bs-toggle="modal" data-bs-target="#existingImageModal_${spaceCount}_${index}" alt="Image Preview">
                    <button type="button" class="delete-button" onclick="removeExistingImage(${spaceCount}, ${index})" title="Remove this image">&times;</button>
                `;

                // Append the image container to the preview
                imagePreviewContainer.appendChild(imgContainer);

                // Create the modal for magnification
                const modal = document.createElement('div');
                modal.classList.add('modal', 'fade');
                modal.id = `existingImageModal_${spaceCount}_${index}`;
                modal.setAttribute('tabindex', '-1');
                modal.setAttribute('aria-labelledby', `existingImageModalLabel_${spaceCount}_${index}`);
                modal.setAttribute('aria-hidden', 'true');
                modal.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="existingImageModalLabel_${spaceCount}_${index}">Image Preview</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <img src="${imageUrl}" class="img-fluid" alt="Full Image">
                            </div>
                        </div>
                    </div>
                `;

                // Append the modal to the body
                document.body.appendChild(modal);
            });
        }

        // Refresh Parsley to recognize new fields
        $('#listSpaceForm').parsley().refresh();
    }


    function calculateMinInventoryUnit(spaceId) {
    const totalArea = parseFloat(document.getElementById(`total_building_area_${spaceId}`).value) || 0;
    const spaceType = document.getElementById(`space_type_${spaceId}`).value;
    const minUnitField = document.getElementById(`min_inventory_unit_${spaceId}`);

    let billableArea = 0;
    switch (spaceType) {
        case 'economy':
            billableArea = 30;
            break;
        case 'average':
            billableArea = 45;
            break;
        case 'spacious':
            billableArea = 60;
            break;
        default:
            billableArea = 0;
    }

    if (billableArea > 0 && totalArea > 0) {
        const minUnits = Math.floor(totalArea / billableArea);
        minUnitField.value = minUnits;
    } else {
        minUnitField.value = '';
    }
}

function generateOfferedFloorsChecklist(spaceId) {
    const totalFloors = parseInt(document.getElementById(`total_floors_${spaceId}`).value) || 0;
    const container = document.getElementById(`offered_floors_container_${spaceId}`);
    container.innerHTML = '';

    if (totalFloors > 0) {
        const label = document.createElement('label');
        label.className = 'form-label fw-bold mt-2';
        label.textContent = 'Select Offered Floors';
        container.appendChild(label);

        const checklist = document.createElement('div');
        checklist.className = 'd-flex flex-wrap gap-2';

        for (let i = 1; i <= totalFloors; i++) {
            const checkboxWrapper = document.createElement('div');
            checkboxWrapper.className = 'form-check';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'form-check-input';
            checkbox.name = `offered_floors_${spaceId}[]`;
            checkbox.value = i;
            checkbox.id = `offered_floor_${spaceId}_${i}`;
            checkbox.required = true;

            const label = document.createElement('label');
            label.className = 'form-check-label';
            label.setAttribute('for', checkbox.id);
            label.textContent = `Floor ${i}`;

            checkboxWrapper.appendChild(checkbox);
            checkboxWrapper.appendChild(label);
            checklist.appendChild(checkboxWrapper);
        }

        container.appendChild(checklist);
    }
}



    // Function to fetch and populate locations in the dropdown
// function populateLocationsDropdown(spaceId, selectedCity = '', selectedMicromarket = '') {
//     const locationDropdown = document.getElementById(`location_${spaceId}`);

//     fetch('/get_locations', { method: 'GET' })
//         .then(response => response.json())
//         .then(data => {
//             const locations = data.locations || [];
//             locations.forEach(location => {
//                 const option = document.createElement('option');
//                 option.value = location;
//                 option.textContent = location;
//                 if (location === selectedCity) {
//                     option.selected = true;
//                 }
//                 locationDropdown.appendChild(option);
//             });

//             // Trigger micromarket population if city is preselected
//             if (selectedCity) {
//                 populateMicromarketDropdown(spaceId, selectedCity, selectedMicromarket);
//             }

//             locationDropdown.addEventListener('change', function () {
//                 const selectedCity = locationDropdown.value;
//                 populateMicromarketDropdown(spaceId, selectedCity);
//             });
//         })
//         .catch(error => console.error('Error fetching locations:', error));
// }

function toCamelCase(input) {
    return input
        .toLowerCase()
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
}

document.querySelectorAll('input[type="number"]').forEach((input) => {
    if (input.value === '') {
        input.value = '0';
    }
});



// Populate locations dropdown
function populateLocationsDropdown(spaceId, selectedCity = '', selectedMicromarket = '') {
    const locationDropdown = document.getElementById(`location_${spaceId}`);
    fetch('/get_locations')
        .then(response => response.json())
        .then(data => {
            console.log('Fetched cities:', data.locations);
            const locations = data.locations || [];
            // Sort locations alphabetically and add "Other" as the last option
            const sortedLocations = [...locations.sort((a, b) => a.localeCompare(b)), "Other"];
            locationDropdown.innerHTML = '<option value="" disabled selected>Select Location *</option>';

            sortedLocations.forEach(location => {
                const camelCasedLocation = toCamelCase(location);
                const option = document.createElement('option');
                option.value = camelCasedLocation;
                option.textContent = camelCasedLocation;
                if (camelCasedLocation === selectedCity) {
                    option.selected = true;
                }
                locationDropdown.appendChild(option);
            });


            locationDropdown.addEventListener('change', function () {
                if (locationDropdown.value === "Other") {
                    showCustomInput('location', spaceId);
                    // Set micromarket dropdown to only have "Other"
                    populateMicromarketDropdown(spaceId, "Other");
                } else {
                    hideCustomInput('location', spaceId);
                    populateMicromarketDropdown(spaceId, locationDropdown.value);
                }
            });

            if (selectedCity) {
                populateMicromarketDropdown(spaceId, selectedCity, selectedMicromarket);
            }
        })
        .catch(error => console.error('Error fetching locations:', error));
}

// Function to fetch and populate micromarkets for a selected location
// function populateMicromarketDropdown(spaceId, selectedCity, selectedMicromarket = '') {
//     const micromarketDropdown = document.getElementById(`micromarket_${spaceId}`);
//     micromarketDropdown.innerHTML = '<option value="" disabled selected>Select Micromarket</option>';
//     micromarketDropdown.disabled = true;

//     fetch(`/get_micromarkets?city=${selectedCity}`, { method: 'GET' })
//         .then(response => response.json())
//         .then(data => {
//             const micromarkets = data.micromarkets || [];
//             micromarkets.forEach(micromarket => {
//                 const option = document.createElement('option');
//                 option.value = micromarket;
//                 option.textContent = micromarket;
//                 if (micromarket === selectedMicromarket) {
//                     option.selected = true;
//                 }
//                 micromarketDropdown.appendChild(option);
//             });

//             micromarketDropdown.disabled = false;
//         })
//         .catch(error => console.error('Error fetching micromarkets:', error));
// }

// Populate micromarkets dropdown
function populateMicromarketDropdown(spaceId, selectedCity, selectedMicromarket = '') {
    const micromarketDropdown = document.getElementById(`micromarket_${spaceId}`);
    micromarketDropdown.innerHTML = '<option value="" disabled selected>Select Micromarket *</option>';

    if (selectedCity === "Other") {
        // Directly add the "Other" option when city is "Other"
        micromarketDropdown.innerHTML += `
            <option value="Other">Other</option>
        `;
        micromarketDropdown.disabled = false;

        // Handle "Other" selection
        micromarketDropdown.addEventListener('change', function () {
            if (micromarketDropdown.value === "Other") {
                showCustomInput('micromarket', spaceId);
            } else {
                hideCustomInput('micromarket', spaceId);
            }
        });
        return; 
    }

    fetch(`/get_micromarkets?city=${selectedCity}`)
        .then(response => response.json())
        .then(data => {
            const micromarkets = data.micromarkets || [];
            // Sort micromarkets alphabetically and add "Other" as the last option
            const sortedMicromarkets = [...micromarkets.sort((a, b) => a.localeCompare(b)), "Other"];

            sortedMicromarkets.forEach(micromarket => {
                const option = document.createElement('option');
                option.value = micromarket;
                option.textContent = micromarket;

                // If a micromarket was already selected, pre-select it
                if (micromarket === selectedMicromarket) {
                    option.selected = true;
                }
                micromarketDropdown.appendChild(option);
            });


            micromarketDropdown.disabled = false;

            micromarketDropdown.addEventListener('change', function () {
                if (micromarketDropdown.value === "Other") {
                    showCustomInput('micromarket', spaceId);
                } else {
                    hideCustomInput('micromarket', spaceId);
                }
            });
        })
        .catch(error => console.error('Error fetching micromarkets:', error));
}

    // Function to add an inventory item
    function addInventory(spaceId, inventoryData = null) {
        const inventoryContainer = document.getElementById(`inventoryContainer_${spaceId}`);

        const inventoryCount = inventoryContainer.childElementCount + 1;

        // Pre-fill values if inventoryData is provided
        const inventoryType = inventoryData ? inventoryData['type'] || '' : '';
        const inventoryCountValue = inventoryData ? inventoryData['count'] || '' : '';
        const pricePerSeat = inventoryData ? inventoryData['price_per_seat'] || '' : '';

        const inventoryRow = document.createElement('div');
        inventoryRow.classList.add('border', 'p-3', 'mb-3', 'position-relative', 'inventory-item');
        inventoryRow.innerHTML = `
            <h6>Inventory ${inventoryCount}</h6>

            <button type="button" class="btn-close position-absolute top-0 end-0 m-2" aria-label="Close" onclick="removeInventory(this)" title="Remove this inventory item"></button>
            <div class="form-group mb-3">
                <div class="mb-3 w-100">
                    <select class="form-select" name="inventory_type_${spaceId}[]" required
                        data-parsley-required-message="Please select an inventory type." data-parsley-trigger="change" aria-label="Inventory Type" onchange="handlePriceChange(this, ${spaceId}, ${inventoryCount})">
                        <option value="" disabled ${!inventoryType ? 'selected' : ''}>Inventory Type</option>
                        <option value="Day pass" ${inventoryType === 'Day pass' ? 'selected' : ''}>Day pass</option>
                        <option value="Dedicated desk" ${inventoryType === 'Dedicated desk' ? 'selected' : ''}>Dedicated desk</option>
                        <option value="Meeting rooms" ${inventoryType === 'Meeting rooms' ? 'selected' : ''}>Meeting rooms</option>
                        <option value="Private cabin" ${inventoryType === 'Private cabin' ? 'selected' : ''}>Private cabin</option>
                        <option value="Virtual office" ${inventoryType === 'Virtual office' ? 'selected' : ''}>Virtual office</option>
                    </select>
                </div>
                <div class="mb-3 w-100">
                    <input type="number" class="form-control" id="priceInput_${spaceId}_${inventoryCount}" name="price_per_seat_${spaceId}[]" placeholder="Price per Seat" min="0" required
                        value="${pricePerSeat}"
                        data-parsley-required-message="Please enter the price per seat."
                        data-parsley-type="number"
                        data-parsley-trigger="change" aria-label="Price per Seat">
                </div>
            </div>
            <div class="form-group mb-3">
                <div class="mb-3 w-100">
                    <input type="number" class="form-control" name="inventory_count_${spaceId}[]" placeholder="Number of Vacant Inventory" min="0" required
                        value="${inventoryCountValue}"
                        onchange="updateCurrentVacancy(${spaceId})"
                        data-parsley-required-message="Please enter the number of vacant inventory."
                        data-parsley-type="number"
                        data-parsley-trigger="change" aria-label="Number of Vacant Inventory">
                </div>
                <!-- Placeholder div to maintain two per row layout -->
                <div style="flex:1;"></div>
            </div>
            <div id="additionalFields_${spaceId}_${inventoryCount}" class="mt-3 mb-2"></div>
            <!-- Meeting Room/Private Cabin Timings Section (Hidden by Default) -->
        <div id="meetingRoomTimings_${spaceId}_${inventoryCount}" class="meeting-room-timings" style="display: none;">
            <h6 id="timingsHeading_${spaceId}_${inventoryCount}"></h6>
            <div class="form-group mb-3 d-flex flex-row gap-3 align-items-center">
                <div class="w-50">
                    <label for="opening_time_${spaceId}_${inventoryCount}" class="form-label">Opening Time *</label>
                    <input type="time" class="form-control" id="opening_time_${spaceId}_${inventoryCount}" name="opening_time_${spaceId}_${inventoryCount}" required
                        data-parsley-required-message="Please enter the opening time."
                        data-parsley-trigger="change">
                </div>
                <div class="w-50">
                    <label for="closing_time_${spaceId}_${inventoryCount}" class="form-label">Closing Time *</label>
                    <input type="time" class="form-control" id="closing_time_${spaceId}_${inventoryCount}" name="closing_time_${spaceId}_${inventoryCount}" required
                        data-parsley-required-message="Please enter the closing time."
                        data-parsley-trigger="change">
                </div>
            </div>
        </div>
            <!-- Upload Inventory Images (Min 2 per Inventory Type) -->
            <div id="inventoryImageSection_${spaceId}_${inventoryCount}" class="inventory-image-section">
    <h6>Upload Images for this Inventory (Min 2)</h6>
    <p class="file-format-note">Upload at least 2 images (JPG, JPEG, PNG).</p>
    <div class="mb-3">
        <input type="file" class="form-control" name="inventory_images_${spaceId}_${inventoryCount}[]" accept="image/png, image/jpeg, image/jpg" multiple
            required data-parsley-mincheck="2"
            data-parsley-required-message="Please upload at least 2 images for this inventory type."
            onchange="previewInventoryImages(event, ${spaceId}, ${inventoryCount})">
    </div>
    <div id="inventoryImagePreview_${spaceId}_${inventoryCount}" class="d-flex flex-wrap"></div>
</div>
        `;
        inventoryContainer.appendChild(inventoryRow);

        // Refresh Parsley to recognize new fields
        $('#listSpaceForm').parsley().refresh();
    }

    // Update current vacancy and validate against total seats
    function updateCurrentVacancy(spaceId) {
        const inventoryCounts = document.querySelectorAll(`#inventoryContainer_${spaceId} input[name^="inventory_count_${spaceId}"]`);
        const totalSeatsField = document.querySelector(`input[name="total_seats[]"][aria-label="Total Seats"]`);
        const currentVacancyField = document.getElementById(`current_vacancy_${spaceId}`);
        const totalSeats = parseInt(totalSeatsField.value) || 0;
        let totalVacancy = 0;

        // Sum up all inventory counts
        inventoryCounts.forEach(input => {
            totalVacancy += parseInt(input.value) || 0;
        });

        // Update the current vacancy field
        currentVacancyField.value = totalVacancy;

        // Validation: Ensure totalVacancy <= totalSeats
        const errorContainer = document.getElementById(`vacancyError_${spaceId}`);
        if (totalVacancy > totalSeats) {
            // Show error if the current vacancy exceeds total seats
            errorContainer.textContent = "Current vacancy cannot exceed total seats.";
            currentVacancyField.setCustomValidity("Invalid current vacancy.");
            // Show styled alert box
            showAlert("Error: Current vacancy cannot exceed total seats.");
        } else {
            // Clear the error if validation passes
            errorContainer.textContent = "";
            currentVacancyField.setCustomValidity("");
        }
    }

    function showAlert(message) {
        // Create the alert box
        const alertBox = document.createElement("div");
        alertBox.className = "alert alert-danger text-center fw-bold";
        alertBox.style.position = "fixed";
        alertBox.style.top = "20px";
        alertBox.style.left = "50%";
        alertBox.style.transform = "translateX(-50%)";
        alertBox.style.zIndex = "1050";
        alertBox.style.width = "50%";
        
        // Add the message to the alert box
        alertBox.innerHTML = `
            <span>${message}</span>
            <button type="button" class="btn-close" aria-label="Close"></button>
        `;

        // Append to the body
        document.body.appendChild(alertBox);

        // Add click event to the close button
        const closeButton = alertBox.querySelector(".btn-close");
        closeButton.addEventListener("click", () => {
            alertBox.remove();
        });
    }

function generateRoomDetails(spaceId, inventoryCount, roomType, numberOfRooms) {
    const container = document.getElementById(`additionalFields_${spaceId}_${inventoryCount}`);
    const existingInputs = container.querySelectorAll('input');

    // 🔁 Store existing values in a dictionary
    const preservedData = {};
    existingInputs.forEach((input) => {
        if (input.name) preservedData[input.name] = input.value;
    });

    container.innerHTML = '';

    // Create label
    const numberOfRoomsLabel = document.createElement('label');
    numberOfRoomsLabel.setAttribute('for', `number_of_rooms_${spaceId}_${inventoryCount}`);
    numberOfRoomsLabel.className = 'form-label fw-bold mt-3';
    numberOfRoomsLabel.textContent = roomType === 'Meeting rooms' ? 'Number of Meeting Rooms *' : 'Number of Private Cabins *';

    // Recreate number input field
    const numberOfRoomsInput = document.createElement('input');
    numberOfRoomsInput.type = 'number';
    numberOfRoomsInput.className = 'form-control mt-2';
    numberOfRoomsInput.name = `number_of_rooms_${spaceId}_${inventoryCount}`;
    numberOfRoomsInput.id = `number_of_rooms_${spaceId}_${inventoryCount}`;
    numberOfRoomsInput.placeholder = roomType === 'Meeting rooms' ? 'Number of Meeting Rooms' : 'Number of Private Cabins';
    numberOfRoomsInput.min = '1';
    numberOfRoomsInput.required = true;
    numberOfRoomsInput.value = numberOfRooms;
    numberOfRoomsInput.setAttribute('data-parsley-required-message', 'Please enter the number of rooms.');
    numberOfRoomsInput.setAttribute('data-parsley-type', 'number');

    numberOfRoomsInput.addEventListener('input', function () {
        const val = parseInt(this.value) || 0;
        generateRoomDetails(spaceId, inventoryCount, roomType, val);
    });

    numberOfRoomsInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            const val = parseInt(this.value) || 0;
            generateRoomDetails(spaceId, inventoryCount, roomType, val);
        }
    });

    // Append label and input
    container.appendChild(numberOfRoomsLabel);
    container.appendChild(numberOfRoomsInput);

    // 🔁 Generate fields based on current number of rooms
    for (let i = 1; i <= numberOfRooms; i++) {
        const heading = document.createElement('h6');
        heading.className = 'mt-3';
        heading.textContent = `${roomType === 'Meeting rooms' ? 'Meeting Room' : 'Private Cabin'} ${i}`;
        container.appendChild(heading);

        const inputContainer = document.createElement('div');
        inputContainer.className = 'd-flex gap-3 mb-3 room-details wrap';

        const seatingInput = document.createElement('input');
        seatingInput.type = 'number';
        seatingInput.className = 'form-control';
        seatingInput.name = `seating_capacity_${spaceId}_${inventoryCount}_${i}`;
        seatingInput.placeholder = `Seating Capacity`;
        seatingInput.min = '1';
        seatingInput.required = true;
        seatingInput.setAttribute('data-parsley-required-message', 'Please enter seating capacity.');
        seatingInput.setAttribute('data-parsley-type', 'number');

        // ✅ Restore value if it exists
        if (preservedData[seatingInput.name]) {
            seatingInput.value = preservedData[seatingInput.name];
        }

        inputContainer.appendChild(seatingInput);
        container.appendChild(inputContainer);

        const imageUploadContainer = document.createElement('div');
        imageUploadContainer.innerHTML = `
            <h6>Upload Images for ${roomType === 'Meeting rooms' ? 'Meeting Room' : 'Private Cabin'} ${i} (Min 2)</h6>
            <div class="mb-3">
                <input type="file" class="form-control" name="${roomType === 'Meeting rooms' ? 'meeting_room_images' : 'private_cabin_images'}_${spaceId}_${inventoryCount}_${i}[]" accept="image/png, image/jpeg, image/jpg" multiple
                    required data-parsley-mincheck="2"
                    data-parsley-required-message="Please upload at least 2 images."
                    onchange="previewRoomImages(event, ${spaceId}, ${inventoryCount}, ${i}, '${roomType}')">
            </div>
            <div id="roomImagePreview_${spaceId}_${inventoryCount}_${i}" class="d-flex flex-wrap"></div>
        `;
        container.appendChild(imageUploadContainer);
    }

    $('#listSpaceForm').parsley().refresh();
}

// Function to generate seating capacity and price inputs based on the number of rooms/cabins
// function generateRoomDetails(spaceId, inventoryCount, roomType,numberOfRooms) {
//     const additionalFieldsContainer = document.getElementById(`additionalFields_${spaceId}_${inventoryCount}`);

//     // Clear any previously generated fields
//     additionalFieldsContainer.innerHTML = '';
    

//     // Add back the "Number of Meeting Rooms" input so it stays visible
//     let numberOfRoomsInput = document.getElementById(`number_of_rooms_${spaceId}_${inventoryCount}`);
//     if (!numberOfRoomsInput) {
//         numberOfRoomsInput = document.createElement('input');
//         numberOfRoomsInput.type = 'number';
//         numberOfRoomsInput.className = 'form-control mt-2';
//         numberOfRoomsInput.name = `number_of_rooms_${spaceId}_${inventoryCount}`;
//         numberOfRoomsInput.id = `number_of_rooms_${spaceId}_${inventoryCount}`;
//         numberOfRoomsInput.placeholder = roomType === 'Meeting rooms' ? 'Number of Meeting Rooms' : 'Number of Private Cabins';
//         numberOfRoomsInput.min = '1';
//         numberOfRoomsInput.required = true;
//         numberOfRoomsInput.setAttribute('data-parsley-required-message', 'Please enter the number of rooms.');
//         numberOfRoomsInput.setAttribute('data-parsley-type', 'number');

//         additionalFieldsContainer.appendChild(numberOfRoomsInput);
//     }

//     // Preserve value and make it readonly
//     numberOfRoomsInput.value = numberOfRooms;
//     numberOfRoomsInput.display = block;

//     if (numberOfRooms >= 0) {
//         for (let i = 1; i <= numberOfRooms; i++) {
//             // Add Heading for each room/cabin
//             const heading = document.createElement('h6');
//             heading.className = 'mt-3';
//             heading.textContent = `${roomType === 'Meeting rooms' ? 'Meeting Room' : 'Private Cabin'} ${i}`;
//             additionalFieldsContainer.appendChild(heading);

//             // Create a flex container for inputs
//             const inputContainer = document.createElement('div');
//             inputContainer.className = 'd-flex gap-3 mb-3 room-details wrap';

//             // Conditionally create Seating Capacity input
//             // Seating Capacity
//             const seatingCapacityInput = document.createElement('input');
//             seatingCapacityInput.type = 'number';
//             seatingCapacityInput.className = 'form-control';
//             seatingCapacityInput.name = `seating_capacity_${spaceId}_${inventoryCount}_${i}`;
//             seatingCapacityInput.placeholder = `Seating Capacity`;
//             seatingCapacityInput.min = '1';
//             seatingCapacityInput.required = true;
//             seatingCapacityInput.setAttribute('data-parsley-required-message', 'Please enter seating capacity.');
//             seatingCapacityInput.setAttribute('data-parsley-type', 'number');
//             inputContainer.appendChild(seatingCapacityInput);

//             console.log(`Seating Capacity Field Created: seating_capacity_${spaceId}_${inventoryCount}_${i}`); // Debug

//             additionalFieldsContainer.appendChild(inputContainer);
//             // Price
//             // const priceInput = document.createElement('input');
//             // priceInput.type = 'number';
//             // priceInput.className = 'form-control';
//             // priceInput.name = `price_${spaceId}_${inventoryCount}_${i}`;
//             // priceInput.placeholder = roomType === 'Meeting rooms' ? `Price per Hour` : `Price per Seat per Month`;
//             // priceInput.min = '1';
//             // priceInput.required = true;
//             // priceInput.setAttribute('data-parsley-required-message', 'Please enter the price.');
//             // priceInput.setAttribute('data-parsley-type', 'number');
//             // inputContainer.appendChild(priceInput);

//             // console.log(`Price Field Created: price_${spaceId}_${inventoryCount}_${i}`); // Debug

//             // Separate Image Upload for each Room/Cabin
//             const imageUploadContainer = document.createElement('div');
//             imageUploadContainer.innerHTML = `
//                 <h6>Upload Images for ${roomType === 'Meeting rooms' ? 'Meeting Room' : 'Private Cabin'} ${i} (Min 2)</h6>
//                 <div class="mb-3">
//                     <input type="file" class="form-control" name="${roomType === 'Meeting rooms' ? 'meeting_room_images' : 'private_cabin_images'}_${spaceId}_${inventoryCount}_${i}[]" accept="image/png, image/jpeg, image/jpg" multiple
//                         required data-parsley-mincheck="2"
//                         data-parsley-required-message="Please upload at least 2 images for this ${roomType === 'Meeting rooms' ? 'Meeting Room' : 'Private Cabin'}."
//                         onchange="previewRoomImages(event, ${spaceId}, ${inventoryCount}, ${i}, '${roomType}')">
//                 </div>
//                 <div id="roomImagePreview_${spaceId}_${inventoryCount}_${i}" class="d-flex flex-wrap"></div>
//             `;
//             // Append the input container to the fields container
//             additionalFieldsContainer.appendChild(imageUploadContainer);
//         }
//     }

//     // Refresh Parsley validation after changes
//     $('#listSpaceForm').parsley().refresh();
// }


function previewRoomImages(event, spaceId, inventoryId, roomId, roomType) {
    const imagePreviewContainer = document.getElementById(`roomImagePreview_${spaceId}_${inventoryId}_${roomId}`);
    imagePreviewContainer.innerHTML = '';
    const files = event.target.files;

    if (files.length < 2) {
        alert("Please upload at least 2 images for this " + (roomType === 'Meeting rooms' ? 'Meeting Room' : 'Private Cabin') + ".");
        event.target.value = "";
        return;
    }

    Array.from(files).forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function (e) {
            const imgContainer = document.createElement('div');
            imgContainer.classList.add('preview-img-container');
            imgContainer.innerHTML = `<img src="${e.target.result}" class="preview-img" alt="Room Image Preview">`;
            imagePreviewContainer.appendChild(imgContainer);
        };
        reader.readAsDataURL(file);
    });
}
    // Function to handle dynamic change for price input
    function handlePriceChange(selectElement, spaceId, inventoryCount) {
        const selectedValue = selectElement.value;
        const priceInput = document.getElementById(`priceInput_${spaceId}_${inventoryCount}`);
        const inventoryCountInput = document.querySelector(`input[name="inventory_count_${spaceId}[]"]`);
        const additionalFieldsContainer = document.getElementById(`additionalFields_${spaceId}_${inventoryCount}`);
        const inventoryImageUpload = document.querySelector(`input[name="inventory_images_${spaceId}_${inventoryCount}[]"]`);
        const inventoryImageSection = document.getElementById(`inventoryImageSection_${spaceId}_${inventoryCount}`);
        const meetingRoomTimings = document.getElementById(`meetingRoomTimings_${spaceId}_${inventoryCount}`);
        const timingsHeading = document.getElementById(`timingsHeading_${spaceId}_${inventoryCount}`);

        // Reset the additional fields container
    additionalFieldsContainer.innerHTML = '';
    // Hide fields initially
    meetingRoomTimings.style.display = 'none';
    inventoryImageSection.style.display = 'block'; // Show image section by default
    inventoryCountInput.style.display = 'block'; // Show vacant inventory field by default
        // Hide common inventory image upload section for Meeting Rooms or Private Cabin
    // Hide common inventory image upload section for Meeting Rooms or Private Cabin
    if (selectedValue === 'Meeting rooms' || selectedValue === 'Private cabin') {
        inventoryImageSection.style.display = 'none';
        inventoryCountInput.style.display = 'block';
        meetingRoomTimings.style.display = 'block'; // ✅ Show Timings Section
        timingsHeading.textContent = selectedValue === 'Meeting rooms' ? 'Meeting Room Timings' : 'Private Cabin Timings';
    } else {
        inventoryImageSection.style.display = 'block';
        inventoryCountInput.style.display = 'block';
        meetingRoomTimings.style.display = 'none'; // ✅ Hide Timings Section
    }
    
    // ✅ Hide the upload section for Meeting Rooms & Private Cabins
    if (selectedValue === 'Meeting rooms' || selectedValue === 'Private cabin') {
        inventoryImageSection.style.display = 'none';
    } else {
        inventoryImageSection.style.display = 'block';
    }
    // Hide the "Number of Vacant Inventory" field
    if (selectedValue === 'Meeting rooms' || selectedValue === 'Private cabin') {
        inventoryCountInput.style.display = 'block';
    } else {
        inventoryCountInput.style.display = 'block';
    }

        // Clear previous additional fields
        additionalFieldsContainer.innerHTML = '';

        priceInput.style.display = 'block';
        inventoryCountInput.style.display = 'block';


        // If Meeting Room or Private Cabin is selected
    if (selectedValue === 'Meeting rooms' || selectedValue === 'Private cabin') {
        // Hide the number of vacant inventory and price per seat fields


        inventoryCountInput.style.display = 'block';

        // Add input for number of rooms/cabins
        // Add input for number of rooms/cabins
        let numberOfRoomsInput = document.getElementById(`number_of_rooms_${spaceId}_${inventoryCount}`);
        if (!numberOfRoomsInput) {
            // Add input for number of rooms/cabins
        const numberOfRoomsInput = document.createElement('input');
        numberOfRoomsInput.type = 'number';
        numberOfRoomsInput.className = 'form-control mt-2';
        numberOfRoomsInput.name = `number_of_rooms_${spaceId}_${inventoryCount}`;  // Add this line
        numberOfRoomsInput.id = `number_of_rooms_${spaceId}_${inventoryCount}`; // Add an ID for better traceability
        numberOfRoomsInput.placeholder = selectedValue === 'Meeting rooms' ? 'Number of Meeting Rooms' : 'Number of Private Cabins';
        numberOfRoomsInput.min = '1';
        numberOfRoomsInput.required = true;
        numberOfRoomsInput.setAttribute('data-parsley-required-message', 'Please enter the number of rooms.');
        numberOfRoomsInput.setAttribute('data-parsley-type', 'number');

        additionalFieldsContainer.appendChild(numberOfRoomsInput);

        // ✅ Fix: Prevent form submission on Enter and generate room details
        numberOfRoomsInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();  // Stop form submission

                    // Trigger `generateRoomDetails()` when Enter is pressed
                    const numberOfRooms = parseInt(numberOfRoomsInput.value) || 0;
                    generateRoomDetails(spaceId, inventoryCount, selectedValue, numberOfRooms);

                    // Refresh Parsley validation after changes
                    $('#listSpaceForm').parsley().destroy();
                    $('#listSpaceForm').parsley();
                }
            });
            // Trigger `generateRoomDetails()` when the number of rooms changes
            numberOfRoomsInput.addEventListener('input', function() {
                const numberOfRooms = parseInt(numberOfRoomsInput.value) || 0;
                generateRoomDetails(spaceId, inventoryCount, selectedValue, numberOfRooms);

                // Refresh Parsley validation after changes
                $('#listSpaceForm').parsley().destroy();
                $('#listSpaceForm').parsley();
            });
        }
        

    } else {
        // Show the number of vacant inventory and price per seat fields for other inventory types
        priceInput.style.display = 'block';
        inventoryCountInput.style.display = 'block';

        switch (selectedValue) {
            case 'Day pass':
                priceInput.placeholder = "Price per Seat per Day";
                priceInput.setAttribute('data-parsley-required-message', 'Please enter the price per seat per day.');
                priceInput.setAttribute('aria-label', 'Price per Seat per Day');
                break;
            case 'Virtual office':
                priceInput.placeholder = "Price per Year";
                priceInput.setAttribute('data-parsley-required-message', 'Please enter the price per seat per year.');
                priceInput.setAttribute('aria-label', 'Price per Seat per Year');
                break;
            case 'Dedicated desk':
                priceInput.placeholder = "Price per Seat per Month";
                priceInput.setAttribute('data-parsley-required-message', 'Please enter the price per seat per month.');
                priceInput.setAttribute('aria-label', 'Price per Seat per Month');
                break;
            default:
                priceInput.placeholder = "Price per Seat";
                priceInput.setAttribute('data-parsley-required-message', 'Please enter the price per seat.');
                priceInput.setAttribute('aria-label', 'Price per Seat');
        }
    }

    // Set placeholders based on selection
    switch (selectedValue) {
        case 'Day pass':
            priceInput.placeholder = "Price per Seat per Day";
            break;
        case 'Virtual office':
            priceInput.placeholder = "Price per Year";
            break;
        case 'Dedicated desk':
            priceInput.placeholder = "Price per Seat per Month";
            break;
        case 'Private cabin':
            priceInput.placeholder = "Price per Seat per Month"; // ✅ Updated
            break;
        case 'Meeting rooms':
            priceInput.placeholder = "Price per Hour"; // ✅ Updated
            break;
        default:
            priceInput.placeholder = "Price per Seat";
    }

    // Refresh Parsley validation after changes
    $('#listSpaceForm').parsley().refresh();
    }

    // Function to remove a coworking space section
    function removeSpaceDetails(button) {
        const spaceCard = button.closest('.card');
        spaceCard.remove();

        // Refresh Parsley to exclude removed fields
        $('#listSpaceForm').parsley().refresh();
    }

    // Function to remove an inventory item
    function removeInventory(button) {
        const inventoryRow = button.closest('.inventory-item');
        inventoryRow.remove();

        // Refresh Parsley to exclude removed fields
        $('#listSpaceForm').parsley().refresh();
    }

    // Function to preview uploaded images
    function previewImages(event, spaceId) {
        const imagePreviewContainer = document.getElementById(`imagePreview_${spaceId}`);
        imagePreviewContainer.innerHTML = '';
        const files = event.target.files;

        Array.from(files).forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgContainer = document.createElement('div');
                imgContainer.classList.add('preview-img-container');
                imgContainer.innerHTML = `
                    <img src="${e.target.result}" class="preview-img" data-bs-toggle="modal" data-bs-target="#imageModal_${spaceId}_${index}" alt="Image Preview">
                    <button type="button" class="delete-button" onclick="removeImage(${index}, ${spaceId})" title="Remove this image">&times;</button>
                `;

                // Append the image container to the preview
                imagePreviewContainer.appendChild(imgContainer);

                // Create the modal for magnification
                const modal = document.createElement('div');
                modal.classList.add('modal', 'fade');
                modal.id = `imageModal_${spaceId}_${index}`;
                modal.setAttribute('tabindex', '-1');
                modal.setAttribute('aria-labelledby', `imageModalLabel_${spaceId}_${index}`);
                modal.setAttribute('aria-hidden', 'true');
                modal.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="imageModalLabel_${spaceId}_${index}">Image Preview</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <img src="${e.target.result}" class="img-fluid" alt="Full Image">
                            </div>
                        </div>
                    </div>
                `;

                // Append the modal to the body
                document.body.appendChild(modal);
            };
            reader.readAsDataURL(file);
        });
    }

    // Function to remove image previews
    function removeImage(index, spaceId) {
        const imagePreviewContainer = document.getElementById(`imagePreview_${spaceId}`);
        const imgToRemove = imagePreviewContainer.querySelectorAll('.preview-img-container')[index];
        if (imgToRemove) {
            imgToRemove.remove();
        }

        // Remove the corresponding modal
        const modalToRemove = document.getElementById(`imageModal_${spaceId}_${index}`);
        if (modalToRemove) {
            modalToRemove.remove();
        }
    }

    // Function to remove existing images (when editing)
    function removeExistingImage(spaceId, index) {
        // Implement functionality to mark the image for deletion
        // For simplicity, we'll just remove it from the preview
        const imagePreviewContainer = document.getElementById(`imagePreview_${spaceId}`);
        const imgContainers = imagePreviewContainer.querySelectorAll('.preview-img-container');
        if (imgContainers[index]) {
            imgContainers[index].remove();
        }

        // Remove the corresponding modal
        const modalToRemove = document.getElementById(`existingImageModal_${spaceId}_${index}`);
        if (modalToRemove) {
            modalToRemove.remove();
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Parsley for the form
        $('#listSpaceForm').parsley();

        // Initialize form with existing data if editing
        if (spaceData) {
            addSpaceDetails(spaceData);
        } else {
            // Add one coworking space section when the page loads
            addSpaceDetails();
        }

        // Optional: Customize Parsley error placement
        $('#listSpaceForm').parsley().on('field:error', function() {
            // Custom behavior on error if needed
        }).on('field:success', function() {
            // Custom behavior on success if needed
        }).on('form:error', function() {
            // Scroll to the first error field
            const firstError = document.querySelector('.parsley-error');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });

        // Handle form submission to show loading spinner and prevent multiple submissions
        document.getElementById('listSpaceForm').addEventListener('submit', function(e) {
            
            const spaceDetailsContainer = document.getElementById('spaceDetailsContainer');

            // Prevent form submission if no coworking space section is present
            if (spaceDetailsContainer.children.length === 0) {
                e.preventDefault();
                alert("You must add at least one coworking space.");
                return;
            }

            // Continue if Parsley validation passes
            var form = $(this);
            form.parsley().validate();

            if (form.parsley().isValid()) {
                // Show the loading spinner
                document.getElementById('loadingSpinner').style.display = 'block';
                // Disable the submit button to prevent multiple submissions
                document.getElementById('submitButton').disabled = true;
            } else {
                // Prevent form submission if validation fails
                e.preventDefault();
            }
        });
    });

    // Function to handle form submission
    document.addEventListener('DOMContentLoaded', function() {
        $('#listSpaceForm').parsley();

        document.getElementById('listSpaceForm').addEventListener('submit', function(e) {
            
            const totalSeatsFields = document.querySelectorAll(`input[name="total_seats[]"]`);

            // Validate current vacancy for all spaces
            totalSeatsFields.forEach((field, index) => {
                updateCurrentVacancy(index + 1);

                // Check if any current vacancy is invalid
                const currentVacancyField = document.getElementById(`current_vacancy_${index + 1}`);
                if (!currentVacancyField.checkValidity()) {
                    e.preventDefault();
                    currentVacancyField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        });
    });

    // Fetch unique locations (cities) from the database and make dropdown scrollable
function fetchLocations() {
    console.log('Fetching locations...');
    fetch('/get_locations', {
        method: 'GET'
    })
    .then(response => response.json())
    .then(data => {
        console.log('Locations data:', data); // Debugging info
        const locationDropdown = document.getElementById(`location_${spaceCount}`);
        locationDropdown.innerHTML = '<option selected disabled>Select Location</option>';
        
        // Sort locations and capitalize the first letter
        const sortedLocations = data.locations
            .map(location => location.charAt(0).toUpperCase() + location.slice(1))
            .sort();

        sortedLocations.forEach(function(location) {
            let option = document.createElement("option");
            option.value = location;
            option.text = location;
            locationDropdown.appendChild(option);
        });

        // Add "Other" option
        let otherOption = document.createElement("option");
        otherOption.value = "Other";
        otherOption.text = "Other";
        locationDropdown.appendChild(otherOption);

        // Adjust size of the dropdown on focus
        locationDropdown.addEventListener('focus', function () {
            locationDropdown.size = 5;
        });

        locationDropdown.addEventListener('change', function () {
            if (locationDropdown.value === "Other") {
                showCustomInput('location', spaceCount);
            } else {
                closeDropdown(`location_${spaceCount}`);
                fetchMicromarkets(); // Fetch micromarkets when location changes
            }
        });
    })
    .catch(error => {
        console.error('Error fetching locations:', error);
    });
}

// Fetch unique micromarkets for the selected city
function fetchMicromarkets() {
    const cityDropdown = document.getElementById(`location_${spaceCount}`);
    const selectedCity = cityDropdown.value; 
    console.log('Fetching micromarkets for city:', selectedCity);

    fetch(`/get_micromarkets?city=${selectedCity}`, {
        method: 'GET'
    })
    .then(response => response.json())
    .then(data => {
        console.log('Micromarkets data:', data); // Debugging info
        // Select the micromarket dropdown dynamically for the specific coworking space card
        const micromarketDropdown = cityDropdown.closest('.form-group').querySelector('select[name="micromarket[]"]');

        if (micromarketDropdown) {
                // Clear and populate the micromarket dropdown
                micromarketDropdown.innerHTML = '<option selected disabled>Select Micromarket</option>';

                // Sort micromarkets and capitalize the first letter
            const sortedMicromarkets = data.micromarkets
                .map(micromarket => micromarket.charAt(0).toUpperCase() + micromarket.slice(1))
                .sort();

            sortedMicromarkets.forEach(function(micromarket) {
                let option = document.createElement("option");
                option.value = micromarket;
                option.text = micromarket;
                micromarketDropdown.appendChild(option);
            });

                // Add "Other" option
                let otherOption = document.createElement("option");
                otherOption.value = "Other";
                otherOption.text = "Other";
                micromarketDropdown.appendChild(otherOption);

                // Ensure the dropdown is clickable
                micromarketDropdown.disabled = false;
                micromarketDropdown.addEventListener('focus', function () {
                    micromarketDropdown.size = 5; // Expand the dropdown on focus
                });

                micromarketDropdown.addEventListener('change', function () {
                if (micromarketDropdown.value === "Other") {
                    showCustomInput('micromarket', spaceCount);
                } else {
                    micromarketDropdown.size = 1; // Close the dropdown on change
                }
            });
            }
        })
        .catch(error => {
            console.error('Error fetching micromarkets:', error);
        });
}

// Function to get the user's current location
function getCurrentLocation(spaceId) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function (position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;

                // Use reverse geocoding API to get the address
                fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.display_name) {
                            document.getElementById(`address_${spaceId}`).value = data.display_name;
                        } else {
                            alert("Unable to retrieve address. Please enter manually.");
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching address:", error);
                        alert("Failed to fetch address. Please check your internet connection.");
                    });
                  // Display the map and initialize Leaflet
                const mapContainer = document.getElementById(`map_${spaceId}`);
                mapContainer.style.display = 'block';

                // Initialize the map
                const map = L.map(`map_${spaceId}`).setView([latitude, longitude], 15);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '© OpenStreetMap'
                }).addTo(map);

                // Add draggable marker
                const marker = L.marker([latitude, longitude], { draggable: true }).addTo(map);

                // Update address field when marker is dragged
                marker.on('dragend', function (e) {
                    const markerLatLng = marker.getLatLng();
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${markerLatLng.lat}&lon=${markerLatLng.lng}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data && data.display_name) {
                                document.getElementById(`address_${spaceId}`).value = data.display_name;
                            } else {
                                alert("Unable to retrieve address. Please enter manually.");
                            }
                        })
                        .catch(error => {
                            console.error("Error fetching address:", error);
                        });
                });
            },
            function (error) {
                console.error("Geolocation error:", error);
                alert("Failed to access location. Please enable location services.");
            }
        );
    } else {
        alert("Geolocation is not supported by this browser.");
    }
}

// Show custom input field when "Other" is selected
// function showCustomInput(type, spaceCount) {
//     const dropdown = document.getElementById(`${type}_${spaceCount}`);
//     const customInputId = `${type}_custom_input_${spaceCount}`; // Unique ID for the custom input field
//     const existingInput = document.getElementById(customInputId);

//     // Check if the custom input field already exists
//     if (!existingInput) {
//         const container = document.createElement("div");
//         container.classList.add("custom-input-container");
//         container.setAttribute("id", customInputId); // Set unique ID for the input container

//         container.innerHTML = `
//             <input type="text" class="form-control mt-2" placeholder="Enter ${type}" name="${type}_custom_${spaceCount}" 
//                 required data-parsley-required-message="Please enter your ${type}." 
//                 data-parsley-trigger="change" aria-label="Custom ${type}" />
//         `;

//         dropdown.parentNode.appendChild(container);

//         // Disable dropdown when custom input is active
//         dropdown.disabled = true;
//     }
// }

// Function to show a custom input field when "Other" is selected
function showCustomInput(type, spaceId) {
    const dropdown = document.getElementById(`${type}_${spaceId}`);
    const customInputId = `${type}_custom_${spaceId}`;
    let customInputContainer = document.getElementById(customInputId);

    if (!customInputContainer) {
        customInputContainer = document.createElement("div");
        customInputContainer.id = customInputId;
        customInputContainer.classList.add("mt-2");

        customInputContainer.innerHTML = `
            <input type="text" class="form-control" placeholder="Enter ${type}" name="${type}_custom_1[]" 
                required data-parsley-required-message="Please enter your ${type}." 
                data-parsley-trigger="change" aria-label="Custom ${type}">
        `;

        dropdown.parentNode.appendChild(customInputContainer);
         // Add event listener to convert input to camel case
        const inputField = customInputContainer.querySelector('input');
        inputField.addEventListener('blur', function () {
            inputField.value = toCamelCase(inputField.value);
        });
    }
}

// Function to hide custom input and re-enable dropdown
function hideCustomInput(type, spaceId) {
    const customInputId = `${type}_custom_${spaceId}`;
    const customInputContainer = document.getElementById(customInputId);

    if (customInputContainer) {
        customInputContainer.remove();
    }

}

// Handle dropdown changes for city and micromarket
function handleDropdownChange(type, spaceId) {
        const dropdown = document.getElementById(`${type}_${spaceId}`);
        dropdown.addEventListener('change', function () {
            if (dropdown.value === "Other") {
                showCustomInput(type, spaceId);
            } else {
                hideCustomInput(type, spaceId);
            }
        });
    }



// Close dropdown after selection
function closeDropdown(dropdownId) {
    const dropdown = document.getElementById(dropdownId);
    dropdown.size = 1; // Close dropdown when an option is selected
}

// Function to preview property images with full-screen modal
function previewPropertyImages(event, spaceId) {
    const imagePreviewContainer = document.getElementById(`propertyImagePreview_${spaceId}`);
    imagePreviewContainer.innerHTML = '';
    const files = event.target.files;

    if (files.length < 5) {
        alert("Please upload at least 5 images of your property.");
        event.target.value = "";
        return;
    }

    Array.from(files).forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function (e) {
            const imgContainer = document.createElement('div');
            imgContainer.classList.add('preview-img-container');
            imgContainer.innerHTML = `
                <img src="${e.target.result}" class="preview-img" data-bs-toggle="modal" data-bs-target="#propertyImageModal_${spaceId}_${index}" alt="Property Image Preview">
                <button type="button" class="delete-button" onclick="removeImage(${index}, ${spaceId}, 'property')">&times;</button>
            `;
            imagePreviewContainer.appendChild(imgContainer);

            // Create modal for full-screen preview
            const modal = document.createElement('div');
            modal.classList.add('modal', 'fade');
            modal.id = `propertyImageModal_${spaceId}_${index}`;
            modal.setAttribute('tabindex', '-1');
            modal.setAttribute('aria-labelledby', `propertyImageModalLabel_${spaceId}_${index}`);
            modal.setAttribute('aria-hidden', 'true');
            modal.innerHTML = `
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Property Image Preview</h5>
                            <button type="button" class="delete-button modal-close-button" data-bs-dismiss="modal" aria-label="Close">&times;</button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="${e.target.result}" class="img-fluid" alt="Full Image">
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        };
        reader.readAsDataURL(file);
    });
}

// Function to preview inventory images with full-screen modal
function previewInventoryImages(event, spaceId, inventoryId) {
    const imagePreviewContainer = document.getElementById(`inventoryImagePreview_${spaceId}_${inventoryId}`);
    imagePreviewContainer.innerHTML = '';
    const files = event.target.files;

    if (files.length < 2) {
        alert("Please upload at least 2 images for this inventory type.");
        event.target.value = "";
        return;
    }

    Array.from(files).forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function (e) {
            const imgContainer = document.createElement('div');
            imgContainer.classList.add('preview-img-container');
            imgContainer.innerHTML = `
                <img src="${e.target.result}" class="preview-img" data-bs-toggle="modal" data-bs-target="#inventoryImageModal_${spaceId}_${inventoryId}_${index}" alt="Inventory Image Preview">
                <button type="button" class="delete-button" onclick="removeImage(${index}, ${spaceId}, 'inventory', ${inventoryId})">&times;</button>
            `;
            imagePreviewContainer.appendChild(imgContainer);

            // Create modal for full-screen preview
            const modal = document.createElement('div');
            modal.classList.add('modal', 'fade');
            modal.id = `inventoryImageModal_${spaceId}_${inventoryId}_${index}`;
            modal.setAttribute('tabindex', '-1');
            modal.setAttribute('aria-labelledby', `inventoryImageModalLabel_${spaceId}_${inventoryId}_${index}`);
            modal.setAttribute('aria-hidden', 'true');
            modal.innerHTML = `
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Inventory Image Preview</h5>
                            <button type="button" class="delete-button modal-close-button" data-bs-dismiss="modal" aria-label="Close">&times;</button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="${e.target.result}" class="img-fluid" alt="Full Image">
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        };
        reader.readAsDataURL(file);
    });
}

// Function to remove uploaded images
function removeImage(index, spaceId, type, inventoryId = null) {
    let imagePreviewContainer;
    let modalId;

    if (type === 'property') {
        imagePreviewContainer = document.getElementById(`propertyImagePreview_${spaceId}`);
        modalId = `propertyImageModal_${spaceId}_${index}`;
    } else if (type === 'inventory') {
        imagePreviewContainer = document.getElementById(`inventoryImagePreview_${spaceId}_${inventoryId}`);
        modalId = `inventoryImageModal_${spaceId}_${inventoryId}_${index}`;
    }

    const imgToRemove = imagePreviewContainer.querySelectorAll('.preview-img-container')[index];
    if (imgToRemove) {
        imgToRemove.remove();
    }

    // Remove the corresponding modal
    const modalToRemove = document.getElementById(modalId);
    if (modalToRemove) {
        modalToRemove.remove();
    }
}

// Handle dropdown close when clicked outside
document.addEventListener('DOMContentLoaded', function () {
        // Initialize event listeners for dropdown changes
        document.querySelectorAll('[id^="location_"], [id^="micromarket_"]').forEach(dropdown => {
            const type = dropdown.id.startsWith('location') ? 'location' : 'micromarket';
            const spaceId = dropdown.id.split('_')[1];
            handleDropdownChange(type, spaceId);
        });
    });

document.addEventListener('DOMContentLoaded', function () {
    addSpaceDetails(); // Add one coworking space by default
        $('#listSpaceForm').parsley();
    });

    document.addEventListener("DOMContentLoaded", function() {
    const workspaceToolDropdown = document.getElementById("workspace_tool");
    const otherToolContainer = document.getElementById("workspace_tool_other_container");
    const otherToolInput = document.getElementById("workspace_tool_other");

    workspaceToolDropdown.addEventListener("change", function() {
        if (this.value === "Other") {
            otherToolContainer.style.display = "block";
            otherToolInput.setAttribute("required", "true"); // Make input required
        } else {
            otherToolContainer.style.display = "none";
            otherToolInput.removeAttribute("required"); // Remove requirement
        }
    });
});

// Ensure hidden inputs are updated before form submission
document.getElementById('listSpaceForm').addEventListener('submit', function() {
    const hiddenInputs = document.querySelectorAll('input[type="hidden"][name^="hidden_number_of_rooms_"]');
    hiddenInputs.forEach(hiddenInput => {
        const correspondingVisibleInput = document.getElementById(hiddenInput.id.replace('hidden_', ''));
        if (correspondingVisibleInput) {
            hiddenInput.value = correspondingVisibleInput.value;
            console.log(`Hidden Input Updated Before Submit: ${hiddenInput.name} = ${hiddenInput.value}`);
        }
    });
});

function getDistanceFromPlace(lat, lon, placeType, spaceId) {
    const googleMapsApiKey = "YOUR_GOOGLE_MAPS_API_KEY"; // Replace with your API Key
    const apiUrl = `https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${lat},${lon}&radius=5000&type=${placeType}&key=${googleMapsApiKey}`;

    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            if (data.results.length > 0) {
                const place = data.results[0];
                const distanceInput = document.getElementById(`distance_${placeType}_${spaceId}`);
                distanceInput.value = (place.geometry.location.lat - lat).toFixed(2); // Approximate distance
            }
        })
        .catch(error => console.error(`Error fetching ${placeType} distance:`, error));
}

function getCurrentLocation(spaceId) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function (position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;

                fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.display_name) {
                            document.getElementById(`address_${spaceId}`).value = data.display_name;

                            // Auto-fetch distances
                            getDistanceFromPlace(latitude, longitude, "subway_station", spaceId);
                            getDistanceFromPlace(latitude, longitude, "airport", spaceId);
                            getDistanceFromPlace(latitude, longitude, "bus_station", spaceId);
                            getDistanceFromPlace(latitude, longitude, "train_station", spaceId);
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching address:", error);
                        alert("Failed to fetch address. Please enter manually.");
                    });
            },
            function (error) {
                console.error("Geolocation error:", error);
                alert("Failed to access location. Please enable location services.");
            }
        );
    } else {
        alert("Geolocation is not supported by this browser.");
    }
}

</script>
<script>
document.addEventListener('keydown', function(event) {
    const isInput = ['input', 'select'].includes(event.target.tagName.toLowerCase());
    const isTextarea = event.target.tagName.toLowerCase() === 'textarea';

    if (event.key === 'Enter' && isInput && !isTextarea) {
        event.preventDefault();
        return false;
    }
});
</script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MX8P4NN6"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
</body>
</html>